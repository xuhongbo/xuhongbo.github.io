<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 根本没有“JSON 对象”这回事！ · xuhongbo</title><meta name="description" content="根本没有“JSON 对象”这回事！ - xuhongbo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://xuhongbo.com/atom.xml" title="xuhongbo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章列表</a></li><li class="nav-list-item"><a href="https://github.com/xuhongbo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/abstract/" target="_self" class="nav-list-link">个人简介</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">根本没有“JSON 对象”这回事！</h1><div class="post-info">Mar 11, 2016</div><div class="post-content"><p>写这篇文章的目的是经常看到开发人员说：把字符串转化为 JSON 对象，把 JSON 对象转化成字符串等类似的话题，所以把之前收藏的一篇老外的文章整理翻译了一下，供大家讨论，如有错误，请大家指出，多谢。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>本文的主题是基于 ECMAScript262-3 来写的，2011 年的 262-5 新规范增加了 JSON 对象，和我们平时所说的 JSON 有关系，但是不是同一个东西，文章最后一节会讲到新增加的 JSON 对象。<br><a id="more"></a><br>我想给大家澄清一下一个非常普遍的误解，我认为很多 JavaScript 开发人员都错误地把 JavaScript <code>对象字面量</code>（Object Literals）称为 <code>JSON 对象</code>（JSON Objects），因为他的语法和<a href="http://json.org/" target="_blank" rel="external">JSON规范</a>里描述的一样，但是该规范里也明确地说了 JSON 只是一个<code>数据交换语言</code>，只有我们将之用在 string 上下文的时候它才叫 JSON。</p>
<h2 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h2><p>2 个程序（或服务器、语言等）需要交互通信的时候，他们倾向于使用 string 字符串因为 string 在很多语言里解析的方式都差不多。复杂的数据结构经常需要用到，并且通过各种各样的中括号{}，小括号()，叫括号<code>&lt;&gt;</code>和空格来组成，这个字符串仅仅是按照要求规范好的字符。</p>
<p>为此，我们为了描述这些复杂的数据结构作为一个 string 字符串，制定了标准的规则和语法。JSON 只是其中一种语法，它可以在 string 上下文里描述对象，数组，字符串，数字，布尔型和 null，然后通过程序间传输，并且反序列化成所需要的格式。<a href="http://en.wikipedia.org/wiki/YAML" target="_blank" rel="external">YAML</a> 和<a href="https://en.wikipedia.org/wiki/XML" target="_blank" rel="external"> XML</a>（甚至 <a href="http://benalman.com/news/2009/12/jquery-14-param-demystified/" target="_blank" rel="external">request params</a>）也是流行的数据交换格式，但是，我们喜欢 JSON，谁叫我们是 JavaScript 开发人员呢！</p>
<h2 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h2><p>引用 Mozilla Developer Center 里的几句话，供大家参考：</p>
<ol>
<li>他们是固定的值，不是变量，让你从“字面上”理解脚本。 (<a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Core_Language_Features#Literals" target="_blank" rel="external">Literals</a>)</li>
<li>字符串字面量是由双引号（”）或单引号（’）包围起来的零个或多个字符组成的。(<a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Core_Language_Features#String_Literals" target="_blank" rel="external">Strings Literals</a>)</li>
<li>对象字面量是由大括号（{}）括起来的零个或多个对象的属性名-值对。(<a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Core_Language_Features#Object_Literalshttps://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Core_Language_Features#Object_Literals" target="_blank" rel="external">Object Literals</a>)</li>
</ol>
<h2 id="何时是-JSON，何时不是-JSON？"><a href="#何时是-JSON，何时不是-JSON？" class="headerlink" title="何时是 JSON，何时不是 JSON？"></a>何时是 JSON，何时不是 JSON？</h2><p>JSON 是设计成描述数据交换格式的，他也有自己的语法，这个语法是 JavaScript 的一个子集。 { “prop”: “val” } 这样的声明有可能是 JavaScript 对象字面量也有可能是 JSON 字符串，取决于什么上下文使用它，如果是用在 string 上下文（用单引号或双引号引住，或者从 text 文件读取）的话，那它就是 JSON 字符串，如果是用在对象字面量上下文中，那它就是对象字面量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 这是JSON字符串</div><div class="line">var foo = &apos;&#123; &quot;prop&quot;: &quot;val&quot; &#125;&apos;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 这是对象字面量</div><div class="line">var bar = &#123; &quot;prop&quot;: &quot;val&quot; &#125;;</div></pre></td></tr></table></figure>
<p>而且要注意，JSON 有非常严格的语法，在 string 上下文里{ “prop”: “val” } 是个合法的 JSON，但{ prop: “val” }和{ ‘prop’: ‘val’ }却是不合法的。所有属性名称和它的值都必须用双引号引住，不能使用单引号。另外，即便你用了转义以后的单引号也是不合法的，详细的语法规则可以到<a href="http://json.org/" target="_blank" rel="external">这里查看</a>。</p>
<h2 id="放到上下文里来看"><a href="#放到上下文里来看" class="headerlink" title="放到上下文里来看"></a>放到上下文里来看</h2><p>大家伙可能嗤之以鼻：难道 JavaScript 代码不是一个大的字符串？</p>
<p>当然是，所有的 JavaScrip t代码和 HTML（可能还有其他东西）都是字符串，直到浏览器对他们进行解析。这时候 .jf 文件或者 inline 的 JavaScript 代码已经不是字符串了，而是被当成真正的 JavaScript 源代码了，就像页面里的 innterHTML 一样，这时候也不是字符串了，而是被解析成 DOM 结构了。</p>
<p>再次说一下，这取决于上下文，在 string 上下文里使用带有大括号的 JavaScript 对象，那它就是 JSON 字符串，而如果在对象字面量上下文里使用的话，那它就是对象字面量。</p>
<h2 id="真正的-JSON-对象"><a href="#真正的-JSON-对象" class="headerlink" title="真正的 JSON 对象"></a>真正的 JSON 对象</h2><p>开头已经提到，对象字面量不是 JSON 对象，但是有<a href="https://developer.mozilla.org/en/Using_native_JSON" target="_blank" rel="external">真正的 JSON 对象</a>。但是两者完全不一样概念，在新版的浏览器里 JSON 对象已经被原生的内置对象了，目前有 2 个静态方法：<code>JSON.parse</code> 用来将 JSON 字符串反序列化成对象，<code>JSON.stringify</code> 用来将对象序列化成 JSON 字符串。老版本的浏览器不支持这个对象，但你可以通过 <a href="http://json.org/" target="_blank" rel="external">json2.js</a> 来实现同样的功能。</p>
<p>如果还不理解，别担心，参考一下的例子就知道了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 这是JSON字符串，比如从AJAX获取字符串信息</div><div class="line">var my_json_string = &apos;&#123; &quot;prop&quot;: &quot;val&quot; &#125;&apos;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 将字符串反序列化成对象</div><div class="line">var my_obj = JSON.parse( my_json_string );</div><div class="line">alert( my_obj.prop == &apos;val&apos; ); //  提示 true, 和想象的一样!</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 将对象序列化成JSON字符串</div><div class="line">var my_other_json_string = JSON.stringify( my_obj );</div></pre></td></tr></table></figure>
<p>另外，<a href="http://paulirish.com/" target="_blank" rel="external">Paul Irish</a>提到 Douglas Crockford 在 <a href="http://www.ietf.org/rfc/rfc4627.txt?number=4627" target="_blank" rel="external">JSON RFC </a>里用到了“JSON object”，但是在那个上下文里，他的意思是“对象描述成 JSON 字符串”不是“对象字面量”。</p>
<h2 id="更多资料"><a href="#更多资料" class="headerlink" title="更多资料"></a>更多资料</h2><p>如果你想了解更多关于 JSON 的资料，下面的连接对你绝对有用：</p>
<ul>
<li><a href="http://json.org/" target="_blank" rel="external">JSON specification</a></li>
<li><a href="http://www.ietf.org/rfc/rfc4627.txt?number=4627" target="_blank" rel="external">JSON RFC</a></li>
<li><a href="http://en.wikipedia.org/wiki/JSON" target="_blank" rel="external">JSON on Wikipedia</a></li>
<li><a href="http://www.jsonlint.com/" target="_blank" rel="external">JSONLint - The JSON Validator</a></li>
<li><a href="http://james.padolsey.com/javascript/json-is-not-the-same-as-json/" target="_blank" rel="external">JSON is not the same as JSON</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2016/03/18/JavaScript/深入理解javascript/21S.O.L.I.D 五大原则之接口隔离原则 ISP/" class="prev">PREV</a><a href="/2016/03/11/JavaScript/深入理解javascript/18面向对象编程之 ECMAScript 实现/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://github.com/xuhongbo" target="_blank">xuhongbo-github</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>