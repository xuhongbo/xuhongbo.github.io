<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ui-router · xuhongbo</title><meta name="description" content="ui-router - xuhongbo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://xuhongbo.com/atom.xml" title="xuhongbo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/idea.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章列表</a></li><li class="nav-list-item"><a href="https://github.com/xuhongbo" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ui-router</h1><div class="post-info">Dec 14, 2016</div><div class="post-content"><h2 id="为什么用-Route"><a href="#为什么用-Route" class="headerlink" title="为什么用 Route"></a>为什么用 Route</h2><ul>
<li>AJAX 请求不会留下 History 记录</li>
<li>用户无法直接通过 URL 进入应用中的指定页面(保存书签、链接分享给朋友)</li>
<li><p>AJAX 对 SEO 是个灾难</p>
<a id="more"></a>
<h2 id="前端路由的基本原理"><a href="#前端路由的基本原理" class="headerlink" title="前端路由的基本原理"></a>前端路由的基本原理</h2></li>
<li><p>哈希 #</p>
</li>
<li><p>HTML5 中新的 history API</p>
</li>
<li><p>路由的核心是给应用定义 “状态”</p>
</li>
<li><p>使用路由机制会影响到应用的整体编码方式(需预先定义好状态)</p>
</li>
<li><p>考虑兼容性问题与 “优雅降级”</p>
<p>​</p>
<p>​</p>
</li>
</ul>
<p>1.多视图用@，嵌套用parent.child这种子路由</p>
<blockquote>
<p>要切换的视图(main)用ui-view,始终不会变成其他内容的不需要路由</p>
</blockquote>
<p>2.要切换的路由ui-sref用子路由</p>
<p>1.文件结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">D:.douban</div><div class="line">|</div><div class="line">│  index.html                       </div><div class="line">│                                   </div><div class="line">├─css                               </div><div class="line">│      bootstrap.css                </div><div class="line">│      index.css                    </div><div class="line">│                                   </div><div class="line">├─js                                </div><div class="line">│      angular-1.3.0.js             </div><div class="line">│      angular-animate.js           </div><div class="line">│      angular-ui-router.js         </div><div class="line">│      app.js                       </div><div class="line">│      ui-bootstrap-tpls-0.11.0.js  </div><div class="line">│                                   </div><div class="line">└─src                               </div><div class="line">        addUser.html                </div><div class="line">        bottomBar.html              </div><div class="line">        home.html                   </div><div class="line">        index.html                  </div><div class="line">        userInfo.html</div></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> &gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/bootstrap.css"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/angular-1.3.0.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/angular-animate.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/angular-ui-router.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	</div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined">.active &#123; color: red; font-weight: bold; &#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"helloworld"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myApp = angular.module(<span class="string">'helloworld'</span>, [<span class="string">'ui.router'</span>]);</div><div class="line"><span class="comment">// 路由机制</span></div><div class="line"><span class="comment">//这一行声明了把$stateProvider和$urlRouterProvider路由引擎作为函数参数传入，这样我们就可易为这个应用程序配置路由了</span></div><div class="line">myApp.config(<span class="function"><span class="keyword">function</span>(<span class="params">$stateProvider, $urlRouterProvider</span>) </span>&#123;</div><div class="line">  <span class="comment">//下面一行的意思是：如果没有路由引擎能匹配当前的导航状态，那它就会默认将路径路由至PageTab.html，这个页面就是状态名称被声明的地方。只要理解了这个，那么它就像switch case语句中的default选项</span></div><div class="line">  $urlRouterProvider.otherwise(<span class="string">'/index'</span>);</div><div class="line">  $stateProvider</div><div class="line">    .state(<span class="string">'index'</span>, &#123;</div><div class="line">      <span class="attr">url</span>: <span class="string">'/index'</span>,</div><div class="line"><span class="comment">// view 用在该状态下有多个 ui-view 的情况，可以对不同的 ui-view 使用特定的 template, controller, resolve data</span></div><div class="line"><span class="comment">// 绝对 view 使用 '@' 符号来区别，比如 'foo@bar' 表明名为 'foo' 的 ui-view 使用了 'bar' 状态的模板(template)，相对 view 则无</span></div><div class="line">      views: &#123;</div><div class="line">        <span class="comment">//无名view</span></div><div class="line">        <span class="string">''</span>: &#123;</div><div class="line">         <span class="comment">//配置templateUrl属性，来加载指定位置的模板，这是设置模板的常用方法</span></div><div class="line">          templateUrl: <span class="string">'src/index.html'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="comment">//main在index模块中</span></div><div class="line">        <span class="string">'main@index'</span>: &#123;</div><div class="line">          <span class="attr">templateUrl</span>: <span class="string">'src/home.html'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">'tabBar@index'</span>: &#123;</div><div class="line">          <span class="attr">templateUrl</span>: <span class="string">'src/bottomBar.html'</span></div><div class="line">          <span class="comment">//在下面也可以直接加参数</span></div><div class="line">          <span class="comment">//controller:'路由到的页面的控制器名称'</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  <span class="comment">//index.userInfo表示路由结构  index/userInfo</span></div><div class="line">    .state(<span class="string">'index.userInfo'</span>, &#123;</div><div class="line">      <span class="attr">url</span>: <span class="string">'/userInfo'</span>,</div><div class="line">      <span class="attr">views</span>: &#123;</div><div class="line">        <span class="comment">//替换之前占位的home.html 替换成userInfo.html</span></div><div class="line">        <span class="string">'main@index'</span>: &#123;</div><div class="line">          <span class="attr">templateUrl</span>: <span class="string">'src/userInfo.html'</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  <span class="comment">//index.userInfo.addUser表示路由结构  index/userInfo/addUser</span></div><div class="line">    .state(<span class="string">'index.userInfo.addUser'</span>, &#123;</div><div class="line">        <span class="attr">url</span>: <span class="string">'/addUser'</span>,</div><div class="line">        <span class="attr">templateUrl</span>: <span class="string">'src/addUser.html'</span></div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>src目录</p>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>=<span class="string">"main"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>=<span class="string">"tabBar"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>home.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"jumbotron text-center"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        首页的形式一般比较<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text-danger"</span>&gt;</span>灵活<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，而且可能随时发生变化。</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>bottomBar.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"index"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"index.userInfo"</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div></pre></td></tr></table></figure>
<p>userInfo.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-3"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-group"</span>&gt;</span></div><div class="line">             //导航</div><div class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"index.userInfo.addUser"</span> <span class="attr">class</span>=<span class="string">"list-group-item"</span>&gt;</span>adduser<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                    </div><div class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-9"</span>&gt;</span></div><div class="line">      //视图</div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="ui-sref-传参"><a href="#ui-sref-传参" class="headerlink" title="ui-sref 传参"></a>ui-sref 传参</h3><h5 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"phones"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"thumbnail phone-list-item"</span> <span class="attr">ng-repeat</span>=<span class="string">"phone in phone_list"</span>&gt;</span></div><div class="line">           //要传的参数</div><div class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"detail(&#123;id:phone.id&#125;)"</span> <span class="attr">class</span>=<span class="string">"thumb"</span>&gt;</span></div><div class="line">             <span class="tag">&lt;<span class="name">img</span> <span class="attr">ng-src</span>=<span class="string">"&#123;&#123; phone.imageUrl &#125;&#125;"</span> <span class="attr">alt</span>=<span class="string">"&#123;&#123; phone.id &#125;&#125;"</span> /&gt;</span></div><div class="line">           <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"detail(&#123;id:phone.id&#125;)"</span>&gt;</span>&#123;&#123; phone.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; phone.snippet &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">         <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.state(<span class="string">'detail'</span>,&#123;</div><div class="line">	<span class="attr">url</span>:<span class="string">'/detail/:id'</span>,<span class="comment">//后面是这种形式的参数http://127.0.0.1:3333/#/detail/motorola-xoom  把参数写在路径里</span></div><div class="line">	templateUrl:<span class="string">'app/detail/detail.html'</span>,</div><div class="line">	<span class="attr">contorller</span>: <span class="string">'detailListController'</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.controller(<span class="string">'detailListController'</span>, [</div><div class="line">		<span class="string">'$scope'</span>,</div><div class="line">		<span class="string">'$http'</span>,</div><div class="line">		<span class="string">'$stateParams'</span>,<span class="comment">//承载上一级传过来的参数</span></div><div class="line">		<span class="function"><span class="keyword">function</span>(<span class="params">$scope, $http,$stateParams</span>) </span>&#123;</div><div class="line">			<span class="built_in">console</span>.log($stateParams)</div><div class="line">		&#125;</div><div class="line">	])</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2017/01/08/JavaScript/运算符/" class="prev">PREV</a><a href="/2016/11/12/深入理解javascript/51深入理解J avaScript 系列（结局篇）/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://github.com/xuhongbo" target="_blank">xuhongbo-github</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>