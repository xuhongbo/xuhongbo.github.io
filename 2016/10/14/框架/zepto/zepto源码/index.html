<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Zepto源码解读 以及前期知识点准备 · xuhongbo</title><meta name="description" content="Zepto源码解读 以及前期知识点准备 - xuhongbo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://xuhongbo.com/atom.xml" title="xuhongbo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章列表</a></li><li class="nav-list-item"><a href="https://github.com/xuhongbo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/abstract/" target="_self" class="nav-list-link">个人简介</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Zepto源码解读 以及前期知识点准备</h1><div class="post-info">Oct 14, 2016</div><div class="post-content"><p>如果你常用zepto，却没有试着深入zepto源码去看看它是如何实现的，你不好奇吗？跟随我，打开zepto的源码来分析一下，看看zepto是用何种方式做成了流行全世界的js库。</p>
<p>本课程内容主要有两个：</p>
<ul>
<li>分析zepto的设计思想，并思考如何才能实现这种设计；</li>
<li>打开zepto源码，看它是如何实现的；</li>
</ul>
<p>扩展内容：</p>
<ul>
<li>作者标注的 zepto core模块的源码注视；</li>
</ul>
<blockquote>
<p>至于为何要解读源码和设计？我想既然来看该教程的朋友，应该都知道它的意义，这里不再唠叨。总之，<strong>拜读经典框架的源码、学习设计思想，就等于站在巨人的肩膀上</strong>。</p>
</blockquote>
<a id="more"></a>
<h2 id="面向的用户"><a href="#面向的用户" class="headerlink" title="面向的用户"></a>面向的用户</h2><ul>
<li>用过zepto，熟悉zepto的常用API（默认你有js基础）</li>
<li>有基础并且想深入学习的『新兵』</li>
</ul>
<h2 id="关于时间"><a href="#关于时间" class="headerlink" title="关于时间"></a>关于时间</h2><p>现说一下，该教程讲义准备的时间是2016年7月份。您看到该教程的时间可能会比这个时间晚很多，但是没关系，该教程讲解的内容应该会一直有效。原因有二：</p>
<ul>
<li>zepto至今早就稳定了，代码不会有很大的变化；</li>
<li>只要ES6没有完全流行开（尚需babel转义），js的语法是不会变的；</li>
</ul>
<p><strong>因此，那些抱怨前端变化快的同学，您该转变一下观念了</strong> ——我一直觉得前端快的只是一小部分，当然这是题外话。</p>
<h2 id="关于文档形式"><a href="#关于文档形式" class="headerlink" title="关于文档形式"></a>关于文档形式</h2><p>仔细考虑以下问题：</p>
<blockquote>
<p>视频教程该用文档还是用ppt？</p>
</blockquote>
<ul>
<li>产品化（文档 - 产品；ppt - 事件）</li>
<li>持续化（文档更易事后查阅）</li>
<li>结构化（使知识更加体系，不零散）</li>
</ul>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>本教程中，讲解设计的部分大约占一半时间，分析源码占另一半时间。因为我觉得，分析和学习设计，比看源码要更加重要。</p>
<p>而另一半时间看源码肯定是看不完的，但是我们也没有必要看完，大家都挺忙的，咱们就好钢用在刀刃上。了解了关键的代码，剩下的完全可以自己来轻松看完——只要你想看。</p>
<p>我正式读过源码的经典框架有4个，我自己的感觉就是——<strong>解读源码之后，真正留在自己脑子里面的，是这个框架的设计思想</strong>。当跟我看完zepto-core的源码之后，你应该会有这种体会。</p>
<h2 id="诡异的数组"><a href="#诡异的数组" class="headerlink" title="诡异的数组"></a>诡异的数组</h2><p>那么接下来，先通过最简单的一个例子看一眼zepto的设计。先来一个很简单的html页面，``中的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;p id=&quot;p1&quot;&gt;测试&lt;/p&gt;</div><div class="line">&lt;div&gt;</div><div class="line">    &lt;span&gt;test&lt;/span&gt;</div><div class="line">    &lt;span&gt;test&lt;/span&gt;</div><div class="line">    &lt;span&gt;test&lt;/span&gt;</div><div class="line">&lt;/div&gt;</div><div class="line"></div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/zepto-1.1.6.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>运行页面，然后在chrome的控制台中输入代码做测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var $p = $(&apos;p&apos;);  // $p 是数组</div><div class="line">var $span = $(&apos;span&apos;);  // $span 是数组</div></pre></td></tr></table></figure>
<p>以上代码中，<code>$p</code>和<code>$span</code>看起来都是数组，这没有问题。但是我们通过API知道，<code>$p.addClass</code>是一个函数，而一般的数组没有<code>addClass</code>这个函数。</p>
<p>如果都是一样的数组，那么<code>$p.addClass</code>是哪里来的呢？显然<code>$p</code>不是一个常规的数组。其实我们还有其他方法可以证明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var arr = [1,2,3];</div><div class="line">var $p = $(&apos;p&apos;);</div><div class="line"></div><div class="line">// 对比1</div><div class="line">arr.__proto__.constructor === Array;  // true</div><div class="line">$p.__proto__.constructor === Array;  // false</div><div class="line"></div><div class="line">// 对比2</div><div class="line">arr instanceof Array;  // true</div><div class="line">$p instanceof Array;  // false</div></pre></td></tr></table></figure>
<p>种种迹象表明，<code>$p</code>是一个看似数组，而非数组的东西。像《聊斋》里的画皮，是否很诡异。。。</p>
<h2 id="先扒一层皮"><a href="#先扒一层皮" class="headerlink" title="先扒一层皮"></a>先扒一层皮</h2><p>如果你对js语法不是很熟练，估计刚才就被这位『画皮』吓蒙了。不过别着急，如果它是画皮，我就是一个称职的老道士。现在先拿一张道符把它点破，然后下一节再教你一招桌妖大法，让你彻底把它打败。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var arr = [1,2,3];</div><div class="line">console.log(arr.__proto__);  // 输入一个对象</div></pre></td></tr></table></figure>
<p>如上代码，<code>arr.__proto__</code>输出了一个对象，对象里面包含了我们常用的操作数组的函数，例如<code>concat</code>,<code>push</code>,<code>map</code>等，<strong>先不要管这个<strong>proto</strong>是什么意思</strong>。就是因为这个<code>__proto__</code>有了这些函数，<code>arr</code>才能使用。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764b28657.png" alt="img"></p>
<p>js语法非常灵活（号称最大的底线就是无底线），对象是可以随便赋值的，那么我就可以将<code>__proto__</code>重新赋值，让数组具有其他函数的功能啊，例如加一个<code>addClass</code>函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var arr = [1,2,3];</div><div class="line">arr.__proto__ = &#123;</div><div class="line">    addClass: function () &#123;</div><div class="line">        console.log(123);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">arr.addClass();   // 123</div></pre></td></tr></table></figure>
<p>注意，经过这一步，<code>arr.concat</code>等其他功能就没有，此时<code>arr</code>就只有<code>addClass</code>这一个函数相依为命了。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764cbc605.png" alt="img"></p>
<p>但是无论如何，此时我们再去拿<code>arr</code>来做第一次的那几个验证，得到的结果就和之前的<code>$p</code>一样了，即<code>arr</code>此时也称了一个不是数组的数组。</p>
<p>而zepto也就是这么干的。</p>
<h2 id="javascript-三座大山"><a href="#javascript-三座大山" class="headerlink" title="javascript 三座大山"></a>javascript 三座大山</h2><p>这个标题其实我自己总结的，目前网络上没有相关的说法。意思就是javascript中比较重要难懂的三点知识。熟练掌握了这三点，你的javascript的基本功才算是过关。否则，你去BAT这种公司去面试前端，估计是过不了关。</p>
<ul>
<li><strong>原型和原型链</strong></li>
<li><strong>上下文环境和作用域</strong></li>
<li><strong>单线程和异步</strong></li>
</ul>
<p>以上这『三座大山』我希望能找机会跟大家单独分享，此处只讲第一个的一部分，即讲到你能看懂后面zepto的设计，就够了。</p>
<h2 id="Array-prototype"><a href="#Array-prototype" class="headerlink" title="Array.prototype"></a><code>Array.prototype</code></h2><p>先记住一句话——<strong>每一个函数，都有一个prototype属性</strong>——每一个函数，无论是你自定义的，还是系统内置的。不信可以试试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var fn = function() &#123;&#125;</div><div class="line">console.log( fn.prototype );</div></pre></td></tr></table></figure>
<p>这里打印出来的<code>fn.prototype</code>是一个对象，只有一个<code>constructor</code>属性，指向该函数自身，即<code>fn.prototype.constructor === fn</code>。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764cd4521.png" alt="img"></p>
<p>以上是自定义的函数，数组构造函数<code>Array</code>也是一个函数，只不过是浏览器内置的函数，它也得符合以上那句话。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">console.log( typeof Array );   // &apos;function&apos;</div><div class="line">console.log( Array.prototype );</div></pre></td></tr></table></figure>
<p>这里打印出来的<code>Array.prototype</code>也是一个对象，也有一个<code>constructor</code>属性，指向该函数自身。只不过还内置了其他的属性——废话，内置的对象毛用没有还内置个卵劲啊。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764d259d6.png" alt="img"></p>
<h2 id="proto"><a href="#proto" class="headerlink" title="[].__proto__"></a><code>[].__proto__</code></h2><p>然后，再记住一句话——<strong>所有通过函数new出来的东西，这个东西都有一个<strong>proto</strong>指向这个函数的prototype</strong>，这里我们给他们分别取一个中文名字：</p>
<ul>
<li><code>prototype</code> （显示）原型</li>
<li><code>__proto__</code> 隐式原型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var arr = [];  // 等价于 var arr = new Array()</div><div class="line">arr.__proto__ === Array.prototype;  // true</div></pre></td></tr></table></figure>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764d3a167.png" alt="img"></p>
<p>然后，再记住一句话——<strong>当你想要使用一个对象（或者一个数组）的某个功能时：如果该对象本身具有这个功能，则直接使用；如果该对象本身没有这个功能，则去<strong>proto</strong>中找</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var obj = &#123;</div><div class="line">    fn1: function () &#123;</div><div class="line">        console.log(&apos;fn1&apos;);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">obj.fn1();  // &apos;fn1&apos;</div><div class="line">obj.toString();  // &apos;[object Object]&apos;  （在 obj.__proto__ 中找到）</div></pre></td></tr></table></figure>
<p>数组也一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var arr = [];</div><div class="line">arr.push(1);   // 在 arr.__proto__ 中找到了 push  方法</div></pre></td></tr></table></figure>
<p>这就是为何数组会有<code>concat</code>、<code>push</code>等方法，顺藤摸瓜最终摸到了<code>Array.prototype</code>中来了。</p>
<p>因此，下列代码是成立的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[].concat === Array.prototype.concat;</div><div class="line">[].push === Array.prototype.push;</div><div class="line">[].map === Array.prototype.map;</div></pre></td></tr></table></figure>
<h2 id="proto-是可修改的"><a href="#proto-是可修改的" class="headerlink" title="__proto__是可修改的"></a><code>__proto__</code>是可修改的</h2><p>上一节我们说过，<code>__proto__</code>就是一个基本的js对象，根据js无底线的语法规则，它是完全可以被修改或者重写的。这里不妨就再多唠叨两句。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764d558af.png" alt="img"></p>
<p>修改<code>__proto__</code>的例子。修改了之后，<code>arr</code>不仅有内置的<code>concat</code>、<code>push</code>等功能，还多了一个<code>addClass</code>功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var arr = [1,2,3];</div><div class="line">arr.__proto__.addClass = function () &#123;</div><div class="line">    console.log(123);</div><div class="line">&#125;</div><div class="line">arr.push(4);</div><div class="line">arr.addClass();   // 123</div></pre></td></tr></table></figure>
<p>完全重写 <code>__proto__</code> 的例子，上一节讲过。还是注意，重写<code>__proto__</code>之后，<code>arr</code>可就失去了<code>concat</code>、<code>push</code>等亲人了，只有一个<code>addClass</code>功能了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var arr = [1,2,3];</div><div class="line">arr.__proto__ = &#123;</div><div class="line">    addClass: function () &#123;</div><div class="line">        console.log(123);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">arr.addClass();   // 123</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>第一，上文中有三句话要记住并且理解；<br>第二，有了这些基础知识，再去扒zepto的皮就轻而易举了；<br>第三，关于js的原型和原型链的知识，真的还有很多话没有说；</p>
<h2 id="回顾zepto对象"><a href="#回顾zepto对象" class="headerlink" title="回顾zepto对象"></a>回顾zepto对象</h2><p>经过了上一节的知识补充之后，我们再回到先前zepto的那个例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"p1"</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>test<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>test<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>test<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/zepto-1.1.6.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> $p1 = $(<span class="string">'#p1'</span>);</div><div class="line">    <span class="built_in">console</span>.log($p1);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> $span = $(<span class="string">'span'</span>);</div><div class="line">    <span class="built_in">console</span>.log($span);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面代码中，我们之前就了解到<code>$p</code>或者<code>$span</code>是一个数组，但是又扩展了其他功能（例如 <code>$p.addClass</code>），这里可以肯定的是，<code>$p.__proto__</code>肯定是被修改过的，而不仅仅是<code>Array.prototype</code>，否则不会有<code>addClass</code>功能。</p>
<h2 id="如何做到的"><a href="#如何做到的" class="headerlink" title="如何做到的"></a>如何做到的</h2><p>源码中如何做的，我们接下来会有详细的描述，不过我们这里可以使用自己的代码简单模拟一下。其实非常简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var arr = [1,2,3];</div><div class="line">arr.__proto__ = &#123;</div><div class="line">    addClass: function  () &#123;</div><div class="line">        console.log(&apos;this is addClass&apos;);</div><div class="line">    &#125;,</div><div class="line">    concat: Array.prototype.concat,</div><div class="line">    push: Array.prototype.push</div><div class="line">&#125;;</div><div class="line"></div><div class="line">arr.push(4);</div><div class="line">arr.addClass();</div></pre></td></tr></table></figure>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764d79a55.png" alt="img"></p>
<p><em>PS：其实源码在实现这个设计的时候，并不像上面代码那么简单，只不过原理是一样的。源码具体的实现方式，还得边解读边了解。</em></p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>以上自己手写了几行代码，就简单模拟了一个zepto的设计结构，那么是不是和zepto一样呢？我们这里简单验证一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var $p = $(&apos;p&apos;);</div><div class="line"></div><div class="line">// 使用 constructor 验证</div><div class="line">arr.__proto__.constructor === $p.__proto__.constructor; // true</div><div class="line"></div><div class="line">// 使用 instanceof 验证</div><div class="line">console.log( $p instanceof Array );  // false</div><div class="line">console.log(arr instanceof Array );  // false</div></pre></td></tr></table></figure>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>如果你仅仅是想了解一下zepto的原理，以上这些内容基本够用了，至少你在公司拿它做个一小时的技术分享是完全没有问题的。</p>
<p>不过，你如果感觉看到这里就收获颇丰，那么我建议你继续跟着我往下看，你会收获更多更实用价值的东西！</p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>将zepto-core的源码下载下来，然后看到最外层的结构是这样的</p>
<p>首先<code>window.Zepto</code>和<code>window.$</code>都赋值了<code>Zepto</code>这个变量，<code>Zepto</code>是个自执行的匿名函数，看源代码的最后几行，匿名函数返回了<code>$</code>变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">return</span> $</div><div class="line">&#125;)()</div><div class="line"></div><div class="line"><span class="comment">// If `$` is not yet defined, point it to `Zepto`</span></div><div class="line"><span class="built_in">window</span>.Zepto = Zepto</div><div class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</div></pre></td></tr></table></figure>
<p>而代码中有如下几行，证明<code>Zepto</code>最终是个函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> zepto.init(selector, context)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以来测试一下，在运行zepto的页面中来验证</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log( <span class="keyword">typeof</span> <span class="built_in">window</span>.$ ); <span class="comment">// 'function'</span></div></pre></td></tr></table></figure>
<p>总结一下，简单写来，这个结构可以简单模拟成这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> $</div><div class="line"></div><div class="line">    <span class="comment">// ...省略N行代码...</span></div><div class="line"></div><div class="line">    $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> zepto.init(selector, context)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...省略N行代码...</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> $</div><div class="line">&#125;)()</div><div class="line"></div><div class="line"><span class="built_in">window</span>.Zepto = Zepto</div><div class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</div></pre></td></tr></table></figure>
<p>而且，在这里我们还可以看到，平常我们<code>$(&#39;p&#39;)</code>使用zepto的时候，最终顺藤摸瓜会执行到<code>$ = function(selector, context){</code>这个函数中（其中的内容可不深究），而<code>p</code>这个选择器也会传递给<code>selector</code>参数。这是我们下一节要讲述的内容。</p>
<h1 id="zepto-init-函数"><a href="#zepto-init-函数" class="headerlink" title="zepto.init 函数"></a>zepto.init 函数</h1><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p>上一节，我们了解了zepto代码的最笼统的一个结构，而且模拟了一下代码。其实当时还漏了一点，就是代码里面有一个<code>zepto</code>变量不知道哪里定义的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> $,</div><div class="line">        zepto = &#123;&#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...省略N行代码...</span></div><div class="line"></div><div class="line">    zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">        <span class="comment">// 函数内容</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> zepto.init(selector, context)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...省略N行代码...</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> $</div><div class="line">&#125;)()</div><div class="line"></div><div class="line"><span class="built_in">window</span>.Zepto = Zepto</div><div class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</div></pre></td></tr></table></figure>
<p>即，我们在创建一个zepto对象例如执行<code>$(&#39;p&#39;)</code>时，会进入<code>zepto.init</code>这个函数，并将参数也响应传递。接下来就进入<code>zepto.init</code>看看这个函数。</p>
<h2 id="zepto-init-函数-1"><a href="#zepto-init-函数-1" class="headerlink" title="zepto.init 函数"></a><code>zepto.init</code> 函数</h2><p><code>zepto.init</code>函数大约有几十行代码，把中间的那些<code>if...else...</code>操作去掉，剩下的就是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> dom</div><div class="line"></div><div class="line">    <span class="comment">// ...此处省略N行...</span></div><div class="line"></div><div class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></div><div class="line">    <span class="keyword">return</span> zepto.Z(dom, selector)</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>中间省略的代码，都是根据不同条件下对<code>dom</code>变量进行赋值。<code>dom</code>从名字也可以猜测出来，它将会赋值一个或多个DOM节点。最终，它将通过<code>selector</code>一起传递给<code>zepto.Z</code>函数并返回值。</p>
<p>至于<code>zepto.Z</code>是个什么鬼暂且先不管，先看看中间省略的代码是什么。</p>
<ul>
<li><strong>无参数，即$()</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If nothing given, return an empty Zepto collection</span></div><div class="line"><span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z()</div></pre></td></tr></table></figure>
<p>上面代码，如果没有参数，将返回一个空的zepto集合，还是交给<code>zepto.Z</code>来处理，先不管。</p>
<ul>
<li><strong>selector参数是字符串，例如$(‘p’) $(‘’) $(‘#content’)</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'string'</span>) &#123;</div><div class="line">  selector = selector.trim()</div><div class="line">  <span class="comment">// If it's a html fragment, create nodes from it</span></div><div class="line">  <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></div><div class="line">  <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></div><div class="line">  <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector))</div><div class="line">    dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></div><div class="line">  <span class="comment">// If there's a context, create a collection on that context first, and select</span></div><div class="line">  <span class="comment">// nodes from there</span></div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</div><div class="line">  <span class="comment">// If it's a CSS selector, use it to select nodes.</span></div><div class="line">  <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码，如果<code>selector</code>是字符串，接下来会有三种情况。</p>
<p>情况1，参数为<code>`这种形式，即是一个html标签的，那么</code>dom<code>变量会被赋值为用这个标签创建的DOM对象，就像</code>dom = document.createElement(‘div’)<code>差不多。其中涉及到了</code>fragmentRE<code>和</code>zepto.fragment`两个我们尚未了解的东东，此处不要深究，知道这段代码的意思即可。</p>
<p>注意，通过测试发现，这里给<code>dom</code>赋值的其实不是一个dom节点对象，而是被封装称了数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If it's a html fragment, create nodes from it</span></div><div class="line"><span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></div><div class="line"><span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></div><div class="line"><span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector))</div><div class="line">  dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></div></pre></td></tr></table></figure>
<p>情况2，如果第二个参数有值，则先根据第二个参数生成zepto对象，然后再调用<code>.find</code>来获取，例如<code>$(&#39;.item&#39;, &#39;#content&#39;)</code>这种用法。<code>find</code>方法是zepto对象的一个函数，API中用法的介绍。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If there's a context, create a collection on that context first, and select</span></div><div class="line"><span class="comment">// nodes from there</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</div></pre></td></tr></table></figure>
<p>情况3，以上两种情况都不是，则调用<code>zepto.qsa</code>来获取数据，后来聊这个方法的具体实现。<code>qsa</code>即<code>querySelectAll</code>的缩写，看名字能大体明白了吧？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If it's a CSS selector, use it to select nodes.</span></div><div class="line"><span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</div></pre></td></tr></table></figure>
<ul>
<li><strong>selector参数是函数，例如$(function(){…})</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If a function is given, call it when the DOM is ready</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector)</div></pre></td></tr></table></figure>
<p>这种用法也比较常见，意思是待dom加载完毕再执行函数。这个<code>ready</code>函数的具体实现后面会讲到，这里先知道意思即可。</p>
<ul>
<li><strong>selector本身就是个zepto对象</strong></li>
</ul>
<p>这种用法比较少，但是也不能避免，例如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = $(<span class="string">'p'</span>);</div><div class="line">$(a);  <span class="comment">// 这里传入的 a 本身就是个 zepto 对象了。</span></div></pre></td></tr></table></figure>
<p>源码中使用<code>zepto.isZ</code>来判断，如果是的话，直接就返回自身。<code>zepto.isZ</code>的实现很简单，看源码即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If a Zepto collection is given, just return it</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector</div></pre></td></tr></table></figure>
<ul>
<li><strong>其他情况</strong></li>
</ul>
<p>当以上情况都不符合的时候，即<code>selector</code>参数既不是空、也不是字符串、也不是函数的时候。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">  <span class="comment">// normalize array if an array of nodes is given</span></div><div class="line">  <span class="keyword">if</span> (isArray(selector)) dom = compact(selector)</div><div class="line">  <span class="comment">// Wrap DOM nodes.</span></div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector))</div><div class="line">    dom = [selector], selector = <span class="literal">null</span></div><div class="line">  <span class="comment">// If it's a html fragment, create nodes from it</span></div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</div><div class="line">    dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></div><div class="line">  <span class="comment">// If there's a context, create a collection on that context first, and select</span></div><div class="line">  <span class="comment">// nodes from there</span></div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</div><div class="line">  <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></div><div class="line">  <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>情况1，<code>selector</code>参数是数组，则通过一个<code>compact</code>处理一下赋值给<code>dom</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// normalize array if an array of nodes is given</span></div><div class="line"><span class="keyword">if</span> (isArray(selector)) dom = compact(selector)</div></pre></td></tr></table></figure>
<p>情况2，<code>selector</code>参数是DOM节点，则将它作为数组赋值给<code>dom</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Wrap DOM nodes.</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector))</div><div class="line">  dom = [selector], selector = <span class="literal">null</span></div></pre></td></tr></table></figure>
<p>剩余情况，其实在<code>selector</code>是字符串的时候就已经考虑到了，因此感觉这里多余了。不过也可能是我考虑不周到，有疏漏的地方，如果谁发现了还望不吝赐教。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// If it's a html fragment, create nodes from it</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</div><div class="line">  dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></div><div class="line"><span class="comment">// If there's a context, create a collection on that context first, and select</span></div><div class="line"><span class="comment">// nodes from there</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</div><div class="line"><span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></div><div class="line"><span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</div></pre></td></tr></table></figure>
<p><strong>这里请注意，虽然有些处理函数这一节没有详细看代码实现，但是最终，赋值给dom的形式是一个数组。就像这段代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Wrap DOM nodes.</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector))</div><div class="line">  dom = [selector], selector = <span class="literal">null</span></div></pre></td></tr></table></figure>
<p>可以针对不同情况的<code>selector</code>，跟踪代码看一下。</p>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p><code>zepto.init</code>函数算是zepto源码中比较复杂的一个函数，一开篇就遇到了个硬骨头。不过我们这里暂且先把那些分叉放在一边，先把大路疏通，然后在慢慢的去一个一个攻破那些分叉。</p>
<p>接下来我们再把<code>init</code>函数的结构梳理一下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> dom</div><div class="line"></div><div class="line">    <span class="comment">// 分情况对dom赋值：</span></div><div class="line">    <span class="comment">// 1. selector 为空</span></div><div class="line">    <span class="comment">// 2. selector 是字符串，其中又分好几种情况</span></div><div class="line">    <span class="comment">// 3. selector 是函数</span></div><div class="line">    <span class="comment">// 4. 其他情况，例如 selector 是数组、对象等</span></div><div class="line"></div><div class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></div><div class="line">    <span class="keyword">return</span> zepto.Z(dom, selector)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="zepto-Z-函数"><a href="#zepto-Z-函数" class="headerlink" title="zepto.Z 函数"></a>zepto.Z 函数</h1><p>只要还能往前走，就先走着，那些岔道回头再说。只要思路捋顺了，那些零碎的问题，都不是问题。</p>
<h2 id="zepto-Z-函数-1"><a href="#zepto-Z-函数-1" class="headerlink" title="zepto.Z 函数"></a><code>zepto.Z</code> 函数</h2><p>上一节了解到<code>zepto.init</code>函数中，最终又将数据传递给了<code>zepto.Z</code>函数。这个函数其实非常简单，如果你看不懂，可能是忘记之前讲过的原型链的知识了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></div><div class="line"><span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></div><div class="line"><span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></div><div class="line"><span class="comment">// Explorer. This method can be overriden in plugins.</span></div><div class="line">zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</div><div class="line">  dom = dom || []</div><div class="line">  dom.__proto__ = $.fn</div><div class="line">  dom.selector = selector || <span class="string">''</span></div><div class="line">  <span class="keyword">return</span> dom</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码中，<code>dom</code>是一个数组，并且把它的隐式原型赋值<code>$.fn</code>，而这里的<code>$.fn</code>其实就是一个普通的js对象（马上要说），跟我们之前讲述js原型链的时候一模一样。</p>
<hr>
<p><strong>PS：后来发现，最新的zepto.Z实现上目前不一样，到最后再给大家聊聊这事儿。不过这丝毫不影响其他代码的讲解，请放心</strong></p>
<h2 id="fn是个什么鬼？"><a href="#fn是个什么鬼？" class="headerlink" title="$.fn是个什么鬼？"></a><code>$.fn</code>是个什么鬼？</h2><p>我们在之前的章节说过，<code>$</code>是一个函数，即</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> zepto.init(selector, context)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而函数也像对象一样，可以随便定义属性赋值的。之前我们说过，每个函数都会有一个内置的<code>prototype</code>属性，这是内置的，我们完全可以自定义一个属性，这个完全可以的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$.fn = &#123;</div><div class="line">    a: 100</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>而zepto源码中，<code>$.fn</code>是这样赋值的，可以去源码中挨个看看其中的属性。</p>
<p><img src="http://box.kancloud.cn/2016-07-03_5778a76cc9f98.png" alt="img"></p>
<p>我们之前模拟过一个zepto设计的代码，还记得吧。我们代码分析到这里，你可以发现，zepto的源码实现，跟我们之前模拟的一模一样。</p>
<p><em>当然，之前的模拟是我故意那么做的，目的是为了将大家更容易的带入进来</em></p>
<h1 id="回顾-1"><a href="#回顾-1" class="headerlink" title="回顾"></a>回顾</h1><p>源码分析到这里，我们用一个简单的代码结构对之前的工作做一个总结。并且根据这个结构，把初始化一个zepto对象的过程在捋一捋。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764d9fab9.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> $,</div><div class="line">        zepto = &#123;&#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...省略N行代码...</span></div><div class="line"></div><div class="line">    zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</div><div class="line">      dom = dom || []</div><div class="line">      dom.__proto__ = $.fn</div><div class="line">      dom.selector = selector || <span class="string">''</span></div><div class="line">      <span class="keyword">return</span> dom</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> dom</div><div class="line"></div><div class="line">        <span class="comment">// 针对参数情况，分别对dom赋值</span></div><div class="line"></div><div class="line">        <span class="comment">// 最终调用 zepto.Z 返回的数据</span></div><div class="line">        <span class="keyword">return</span> zepto.Z(dom, selector)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> zepto.init(selector, context)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $.fn = &#123;</div><div class="line">        <span class="comment">// 里面有若干个工具函数</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...省略N行代码...</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> $</div><div class="line">&#125;)()</div><div class="line"></div><div class="line"><span class="built_in">window</span>.Zepto = Zepto</div><div class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</div></pre></td></tr></table></figure>
<h1 id="最新的zepto-Z函数"><a href="#最新的zepto-Z函数" class="headerlink" title="最新的zepto.Z函数"></a>最新的zepto.Z函数</h1><h2 id="新旧对比"><a href="#新旧对比" class="headerlink" title="新旧对比"></a>新旧对比</h2><p>在准备课程的这个时间 <a href="https://github.com/madrobby/zepto/blob/master/src/zepto.js#files" target="_blank" rel="external">https://github.com/madrobby/zepto/blob/master/src/zepto.js#files</a> 其中的代码中，<code>zepto.Z</code>是这样实现的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> i, len = dom ? dom.length : <span class="number">0</span></div><div class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) <span class="keyword">this</span>[i] = dom[i]</div><div class="line">  <span class="keyword">this</span>.length = len</div><div class="line">  <span class="keyword">this</span>.selector = selector || <span class="string">''</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></div><div class="line"><span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></div><div class="line"><span class="comment">// to the array. This method can be overridden in plugins.</span></div><div class="line">zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector)</div><div class="line">&#125;</div><div class="line"></div><div class="line">$.fn = &#123;</div><div class="line">  <span class="comment">// ...很多属性...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">zepto.Z.prototype = Z.prototype = $.fn</div></pre></td></tr></table></figure>
<p>再把之前的拿出来对比一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></div><div class="line"><span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></div><div class="line"><span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></div><div class="line"><span class="comment">// Explorer. This method can be overriden in plugins.</span></div><div class="line">zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</div><div class="line">  dom = dom || []</div><div class="line">  dom.__proto__ = $.fn</div><div class="line">  dom.selector = selector || <span class="string">''</span></div><div class="line">  <span class="keyword">return</span> dom</div><div class="line">&#125;</div><div class="line"></div><div class="line">$.fn = &#123;</div><div class="line">  <span class="comment">// ...很多属性...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="两者的异同"><a href="#两者的异同" class="headerlink" title="两者的异同"></a>两者的异同</h2><p>第二种实现方式我们已经讲完了，最终它返回的一个数组，并且强制将<code>__proto__</code>修改为<code>$.fn</code>这个对象。这个修改发生在对象上，修改的隐式原型。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764d9fab9.png" alt="img"></p>
<p>而第一种实现方式，是直接将构造函数的原型修改了，即 <code>Z.prototype = $.fn</code>，经过这样一改，构造函数再<code>new</code>出来的对象的隐式原型<code>__proto__</code>自然就指向了<code>$.fn</code>。</p>
<p><img src="http://box.kancloud.cn/2016-07-04_577a764dc04f6.png" alt="img"></p>
<p>另外，第一种方式返回的是一个<code>对象数组</code>，而第二种返回的是一个数组。何谓对象数组？——即可以模拟进行数组操作的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> objArray = &#123;</div><div class="line">    <span class="number">0</span>: <span class="string">'abc'</span>,</div><div class="line">    <span class="number">1</span>: <span class="string">'bcd'</span>,</div><div class="line">    <span class="number">2</span>: <span class="string">'cde'</span>,</div><div class="line">    <span class="attr">length</span>: <span class="number">3</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log( objArray[<span class="number">1</span>] )</div><div class="line"><span class="built_in">console</span>.log( objArray.length )</div></pre></td></tr></table></figure>
<p>那为何不用数组，而用对象数组？——对象本质上更加灵活、直观，例如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">objArray.selector = <span class="string">''</span>;</div></pre></td></tr></table></figure>
<h1 id="附：zepto-core-1-1-6-源码注释"><a href="#附：zepto-core-1-1-6-源码注释" class="headerlink" title="附：zepto-core-1.1.6 源码注释"></a>附：zepto-core-1.1.6 源码注释</h1><h2 id="是否有必要讲解整个源码？"><a href="#是否有必要讲解整个源码？" class="headerlink" title="是否有必要讲解整个源码？"></a>是否有必要讲解整个源码？</h2><p>我个人觉得源码还得靠自己来看，但是自己直接看源码会有点晕头转向，因此本教程分析了整个代码的设计思想，这样再读起来就方便了。</p>
<p>不过如果大部分同学觉得有必要把源码再分析一遍，我可能会准备这样一份教程给大家分享。</p>
<h2 id="源码注视"><a href="#源码注视" class="headerlink" title="源码注视"></a>源码注视</h2><p>以下是我读完了并写了注释了zepto core 模块的源码，如果您想继续阅读其他源码，可参阅。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div><div class="line">1123</div><div class="line">1124</div><div class="line">1125</div><div class="line">1126</div><div class="line">1127</div><div class="line">1128</div><div class="line">1129</div><div class="line">1130</div><div class="line">1131</div><div class="line">1132</div><div class="line">1133</div><div class="line">1134</div><div class="line">1135</div><div class="line">1136</div><div class="line">1137</div><div class="line">1138</div><div class="line">1139</div><div class="line">1140</div><div class="line">1141</div><div class="line">1142</div><div class="line">1143</div><div class="line">1144</div><div class="line">1145</div><div class="line">1146</div><div class="line">1147</div><div class="line">1148</div><div class="line">1149</div><div class="line">1150</div><div class="line">1151</div><div class="line">1152</div><div class="line">1153</div><div class="line">1154</div><div class="line">1155</div><div class="line">1156</div><div class="line">1157</div><div class="line">1158</div><div class="line">1159</div><div class="line">1160</div><div class="line">1161</div><div class="line">1162</div><div class="line">1163</div><div class="line">1164</div><div class="line">1165</div><div class="line">1166</div><div class="line">1167</div><div class="line">1168</div><div class="line">1169</div><div class="line">1170</div><div class="line">1171</div><div class="line">1172</div><div class="line">1173</div><div class="line">1174</div><div class="line">1175</div><div class="line">1176</div><div class="line">1177</div><div class="line">1178</div><div class="line">1179</div><div class="line">1180</div><div class="line">1181</div><div class="line">1182</div><div class="line">1183</div><div class="line">1184</div><div class="line">1185</div><div class="line">1186</div><div class="line">1187</div><div class="line">1188</div><div class="line">1189</div><div class="line">1190</div><div class="line">1191</div><div class="line">1192</div><div class="line">1193</div><div class="line">1194</div><div class="line">1195</div><div class="line">1196</div><div class="line">1197</div><div class="line">1198</div><div class="line">1199</div><div class="line">1200</div><div class="line">1201</div><div class="line">1202</div><div class="line">1203</div><div class="line">1204</div><div class="line">1205</div><div class="line">1206</div><div class="line">1207</div><div class="line">1208</div><div class="line">1209</div><div class="line">1210</div><div class="line">1211</div><div class="line">1212</div><div class="line">1213</div><div class="line">1214</div><div class="line">1215</div><div class="line">1216</div><div class="line">1217</div><div class="line">1218</div><div class="line">1219</div><div class="line">1220</div><div class="line">1221</div><div class="line">1222</div><div class="line">1223</div><div class="line">1224</div><div class="line">1225</div><div class="line">1226</div><div class="line">1227</div><div class="line">1228</div><div class="line">1229</div><div class="line">1230</div><div class="line">1231</div><div class="line">1232</div><div class="line">1233</div><div class="line">1234</div><div class="line">1235</div><div class="line">1236</div><div class="line">1237</div><div class="line">1238</div><div class="line">1239</div><div class="line">1240</div><div class="line">1241</div><div class="line">1242</div><div class="line">1243</div><div class="line">1244</div><div class="line">1245</div><div class="line">1246</div><div class="line">1247</div><div class="line">1248</div><div class="line">1249</div><div class="line">1250</div><div class="line">1251</div><div class="line">1252</div><div class="line">1253</div><div class="line">1254</div><div class="line">1255</div><div class="line">1256</div><div class="line">1257</div><div class="line">1258</div><div class="line">1259</div><div class="line">1260</div><div class="line">1261</div><div class="line">1262</div><div class="line">1263</div><div class="line">1264</div><div class="line">1265</div><div class="line">1266</div><div class="line">1267</div><div class="line">1268</div><div class="line">1269</div><div class="line">1270</div><div class="line">1271</div><div class="line">1272</div><div class="line">1273</div><div class="line">1274</div><div class="line">1275</div><div class="line">1276</div><div class="line">1277</div><div class="line">1278</div><div class="line">1279</div><div class="line">1280</div><div class="line">1281</div><div class="line">1282</div><div class="line">1283</div><div class="line">1284</div><div class="line">1285</div><div class="line">1286</div><div class="line">1287</div><div class="line">1288</div><div class="line">1289</div><div class="line">1290</div><div class="line">1291</div><div class="line">1292</div><div class="line">1293</div><div class="line">1294</div><div class="line">1295</div><div class="line">1296</div><div class="line">1297</div><div class="line">1298</div><div class="line">1299</div><div class="line">1300</div><div class="line">1301</div><div class="line">1302</div><div class="line">1303</div><div class="line">1304</div><div class="line">1305</div><div class="line">1306</div><div class="line">1307</div><div class="line">1308</div><div class="line">1309</div><div class="line">1310</div><div class="line">1311</div><div class="line">1312</div><div class="line">1313</div><div class="line">1314</div><div class="line">1315</div><div class="line">1316</div><div class="line">1317</div><div class="line">1318</div><div class="line">1319</div><div class="line">1320</div><div class="line">1321</div><div class="line">1322</div><div class="line">1323</div><div class="line">1324</div><div class="line">1325</div><div class="line">1326</div><div class="line">1327</div><div class="line">1328</div><div class="line">1329</div><div class="line">1330</div><div class="line">1331</div><div class="line">1332</div><div class="line">1333</div><div class="line">1334</div><div class="line">1335</div><div class="line">1336</div><div class="line">1337</div><div class="line">1338</div><div class="line">1339</div><div class="line">1340</div><div class="line">1341</div><div class="line">1342</div><div class="line">1343</div><div class="line">1344</div><div class="line">1345</div><div class="line">1346</div><div class="line">1347</div><div class="line">1348</div><div class="line">1349</div><div class="line">1350</div><div class="line">1351</div><div class="line">1352</div><div class="line">1353</div><div class="line">1354</div><div class="line">1355</div><div class="line">1356</div><div class="line">1357</div><div class="line">1358</div><div class="line">1359</div><div class="line">1360</div><div class="line">1361</div><div class="line">1362</div><div class="line">1363</div><div class="line">1364</div><div class="line">1365</div><div class="line">1366</div><div class="line">1367</div><div class="line">1368</div><div class="line">1369</div><div class="line">1370</div><div class="line">1371</div><div class="line">1372</div><div class="line">1373</div><div class="line">1374</div><div class="line">1375</div><div class="line">1376</div><div class="line">1377</div><div class="line">1378</div><div class="line">1379</div><div class="line">1380</div><div class="line">1381</div><div class="line">1382</div><div class="line">1383</div><div class="line">1384</div><div class="line">1385</div><div class="line">1386</div><div class="line">1387</div><div class="line">1388</div><div class="line">1389</div><div class="line">1390</div><div class="line">1391</div><div class="line">1392</div><div class="line">1393</div><div class="line">1394</div><div class="line">1395</div><div class="line">1396</div><div class="line">1397</div><div class="line">1398</div><div class="line">1399</div><div class="line">1400</div><div class="line">1401</div><div class="line">1402</div><div class="line">1403</div><div class="line">1404</div><div class="line">1405</div><div class="line">1406</div><div class="line">1407</div><div class="line">1408</div><div class="line">1409</div><div class="line">1410</div><div class="line">1411</div><div class="line">1412</div><div class="line">1413</div><div class="line">1414</div><div class="line">1415</div><div class="line">1416</div><div class="line">1417</div><div class="line">1418</div><div class="line">1419</div><div class="line">1420</div><div class="line">1421</div><div class="line">1422</div><div class="line">1423</div><div class="line">1424</div><div class="line">1425</div><div class="line">1426</div><div class="line">1427</div><div class="line">1428</div><div class="line">1429</div><div class="line">1430</div><div class="line">1431</div><div class="line">1432</div><div class="line">1433</div><div class="line">1434</div><div class="line">1435</div><div class="line">1436</div><div class="line">1437</div><div class="line">1438</div><div class="line">1439</div><div class="line">1440</div><div class="line">1441</div><div class="line">1442</div><div class="line">1443</div><div class="line">1444</div><div class="line">1445</div><div class="line">1446</div><div class="line">1447</div><div class="line">1448</div><div class="line">1449</div><div class="line">1450</div><div class="line">1451</div><div class="line">1452</div><div class="line">1453</div><div class="line">1454</div><div class="line">1455</div><div class="line">1456</div><div class="line">1457</div><div class="line">1458</div><div class="line">1459</div><div class="line">1460</div><div class="line">1461</div><div class="line">1462</div><div class="line">1463</div><div class="line">1464</div><div class="line">1465</div><div class="line">1466</div><div class="line">1467</div><div class="line">1468</div><div class="line">1469</div><div class="line">1470</div><div class="line">1471</div><div class="line">1472</div><div class="line">1473</div><div class="line">1474</div><div class="line">1475</div><div class="line">1476</div><div class="line">1477</div><div class="line">1478</div><div class="line">1479</div><div class="line">1480</div><div class="line">1481</div><div class="line">1482</div><div class="line">1483</div><div class="line">1484</div><div class="line">1485</div><div class="line">1486</div><div class="line">1487</div><div class="line">1488</div><div class="line">1489</div><div class="line">1490</div><div class="line">1491</div><div class="line">1492</div><div class="line">1493</div><div class="line">1494</div><div class="line">1495</div><div class="line">1496</div><div class="line">1497</div><div class="line">1498</div><div class="line">1499</div><div class="line">1500</div><div class="line">1501</div><div class="line">1502</div><div class="line">1503</div><div class="line">1504</div><div class="line">1505</div><div class="line">1506</div><div class="line">1507</div><div class="line">1508</div><div class="line">1509</div><div class="line">1510</div><div class="line">1511</div><div class="line">1512</div><div class="line">1513</div><div class="line">1514</div><div class="line">1515</div><div class="line">1516</div><div class="line">1517</div><div class="line">1518</div><div class="line">1519</div><div class="line">1520</div><div class="line">1521</div><div class="line">1522</div><div class="line">1523</div><div class="line">1524</div><div class="line">1525</div><div class="line">1526</div><div class="line">1527</div><div class="line">1528</div><div class="line">1529</div><div class="line">1530</div><div class="line">1531</div><div class="line">1532</div><div class="line">1533</div><div class="line">1534</div><div class="line">1535</div><div class="line">1536</div><div class="line">1537</div><div class="line">1538</div><div class="line">1539</div><div class="line">1540</div><div class="line">1541</div><div class="line">1542</div><div class="line">1543</div><div class="line">1544</div><div class="line">1545</div><div class="line">1546</div><div class="line">1547</div><div class="line">1548</div><div class="line">1549</div><div class="line">1550</div><div class="line">1551</div><div class="line">1552</div><div class="line">1553</div><div class="line">1554</div><div class="line">1555</div><div class="line">1556</div><div class="line">1557</div><div class="line">1558</div><div class="line">1559</div><div class="line">1560</div><div class="line">1561</div><div class="line">1562</div><div class="line">1563</div><div class="line">1564</div><div class="line">1565</div><div class="line">1566</div><div class="line">1567</div><div class="line">1568</div><div class="line">1569</div><div class="line">1570</div><div class="line">1571</div><div class="line">1572</div><div class="line">1573</div><div class="line">1574</div><div class="line">1575</div><div class="line">1576</div><div class="line">1577</div><div class="line">1578</div><div class="line">1579</div><div class="line">1580</div><div class="line">1581</div><div class="line">1582</div><div class="line">1583</div><div class="line">1584</div><div class="line">1585</div><div class="line">1586</div><div class="line">1587</div><div class="line">1588</div><div class="line">1589</div><div class="line">1590</div><div class="line">1591</div><div class="line">1592</div><div class="line">1593</div><div class="line">1594</div><div class="line">1595</div><div class="line">1596</div><div class="line">1597</div><div class="line">1598</div><div class="line">1599</div><div class="line">1600</div><div class="line">1601</div><div class="line">1602</div><div class="line">1603</div><div class="line">1604</div><div class="line">1605</div><div class="line">1606</div><div class="line">1607</div><div class="line">1608</div><div class="line">1609</div><div class="line">1610</div><div class="line">1611</div><div class="line">1612</div><div class="line">1613</div><div class="line">1614</div><div class="line">1615</div><div class="line">1616</div><div class="line">1617</div><div class="line">1618</div><div class="line">1619</div><div class="line">1620</div><div class="line">1621</div><div class="line">1622</div><div class="line">1623</div><div class="line">1624</div><div class="line">1625</div><div class="line">1626</div><div class="line">1627</div><div class="line">1628</div><div class="line">1629</div><div class="line">1630</div><div class="line">1631</div><div class="line">1632</div><div class="line">1633</div><div class="line">1634</div><div class="line">1635</div><div class="line">1636</div><div class="line">1637</div><div class="line">1638</div><div class="line">1639</div><div class="line">1640</div><div class="line">1641</div><div class="line">1642</div><div class="line">1643</div><div class="line">1644</div><div class="line">1645</div><div class="line">1646</div><div class="line">1647</div><div class="line">1648</div><div class="line">1649</div><div class="line">1650</div><div class="line">1651</div><div class="line">1652</div><div class="line">1653</div><div class="line">1654</div><div class="line">1655</div><div class="line">1656</div><div class="line">1657</div><div class="line">1658</div><div class="line">1659</div><div class="line">1660</div><div class="line">1661</div><div class="line">1662</div><div class="line">1663</div><div class="line">1664</div><div class="line">1665</div><div class="line">1666</div><div class="line">1667</div><div class="line">1668</div><div class="line">1669</div><div class="line">1670</div><div class="line">1671</div><div class="line">1672</div><div class="line">1673</div><div class="line">1674</div><div class="line">1675</div><div class="line">1676</div><div class="line">1677</div><div class="line">1678</div><div class="line">1679</div><div class="line">1680</div><div class="line">1681</div><div class="line">1682</div><div class="line">1683</div><div class="line">1684</div><div class="line">1685</div><div class="line">1686</div><div class="line">1687</div><div class="line">1688</div><div class="line">1689</div><div class="line">1690</div><div class="line">1691</div><div class="line">1692</div><div class="line">1693</div><div class="line">1694</div><div class="line">1695</div><div class="line">1696</div><div class="line">1697</div><div class="line">1698</div><div class="line">1699</div><div class="line">1700</div><div class="line">1701</div><div class="line">1702</div><div class="line">1703</div><div class="line">1704</div><div class="line">1705</div><div class="line">1706</div><div class="line">1707</div><div class="line">1708</div><div class="line">1709</div><div class="line">1710</div><div class="line">1711</div><div class="line">1712</div><div class="line">1713</div><div class="line">1714</div><div class="line">1715</div><div class="line">1716</div><div class="line">1717</div><div class="line">1718</div><div class="line">1719</div><div class="line">1720</div><div class="line">1721</div><div class="line">1722</div><div class="line">1723</div><div class="line">1724</div><div class="line">1725</div><div class="line">1726</div><div class="line">1727</div><div class="line">1728</div><div class="line">1729</div><div class="line">1730</div><div class="line">1731</div><div class="line">1732</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Zepto v1.1.6 - zepto event ajax form ie - zeptojs.com/license */</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>, key, $, classList, </div><div class="line"></div><div class="line">      <span class="comment">// 获取数组的slice 和 filter（返回数组中的满足回调函数中指定的条件的元素）方法</span></div><div class="line">      emptyArray = [], slice = emptyArray.slice, filter = emptyArray.filter,</div><div class="line"></div><div class="line">      <span class="built_in">document</span> = <span class="built_in">window</span>.document,</div><div class="line">      elementDisplay = &#123;&#125;, classCache = &#123;&#125;,</div><div class="line">      cssNumber = &#123;</div><div class="line">        <span class="string">'column-count'</span>: <span class="number">1</span>, </div><div class="line">        <span class="string">'columns'</span>: <span class="number">1</span>, </div><div class="line">        <span class="string">'font-weight'</span>: <span class="number">1</span>, </div><div class="line">        <span class="string">'line-height'</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">'opacity'</span>: <span class="number">1</span>, </div><div class="line">        <span class="string">'z-index'</span>: <span class="number">1</span>, </div><div class="line">        <span class="string">'zoom'</span>: <span class="number">1</span></div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      <span class="comment">// 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></div><div class="line">      fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</div><div class="line">      <span class="comment">// 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></div><div class="line">      singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</div><div class="line">      <span class="comment">// 单标签</span></div><div class="line">      tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span>,</div><div class="line">      <span class="comment">// body html</span></div><div class="line">      rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</div><div class="line">      <span class="comment">// 大写字母</span></div><div class="line">      capitalRE = <span class="regexp">/([A-Z])/g</span>,</div><div class="line"></div><div class="line">      <span class="comment">// special attributes that should be get/set via method calls</span></div><div class="line">      <span class="comment">// 应该通过方法调用来设置/获取的特殊属性</span></div><div class="line">      methodAttributes = [<span class="string">'val'</span>, <span class="string">'css'</span>, <span class="string">'html'</span>, <span class="string">'text'</span>, <span class="string">'data'</span>, <span class="string">'width'</span>, <span class="string">'height'</span>, <span class="string">'offset'</span>],</div><div class="line"></div><div class="line">      adjacencyOperators = [ <span class="string">'after'</span>, <span class="string">'prepend'</span>, <span class="string">'before'</span>, <span class="string">'append'</span> ],</div><div class="line"></div><div class="line">      table = <span class="built_in">document</span>.createElement(<span class="string">'table'</span>),</div><div class="line">      tableRow = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>),</div><div class="line">      <span class="comment">// 指定特殊元素的 容器</span></div><div class="line">      containers = &#123;</div><div class="line">        <span class="string">'tr'</span>: <span class="built_in">document</span>.createElement(<span class="string">'tbody'</span>),</div><div class="line">        <span class="string">'tbody'</span>: table, </div><div class="line">        <span class="string">'thead'</span>: table, </div><div class="line">        <span class="string">'tfoot'</span>: table,</div><div class="line">        <span class="string">'td'</span>: tableRow, </div><div class="line">        <span class="string">'th'</span>: tableRow,</div><div class="line">        <span class="comment">// 除了上面指定的，其他所有元素的容器都是 div</span></div><div class="line">        <span class="string">'*'</span>: <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      <span class="comment">// interactive ？？？</span></div><div class="line">      readyRE = <span class="regexp">/complete|loaded|interactive/</span>,</div><div class="line"></div><div class="line">      <span class="comment">// 匹配一个包括（字母、数组、下划线、-）的字符串</span></div><div class="line">      simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>,</div><div class="line"></div><div class="line">      class2type = &#123;&#125;,</div><div class="line">      toString = class2type.toString,</div><div class="line"></div><div class="line">      zepto = &#123;&#125;,</div><div class="line">      camelize, uniq,</div><div class="line"></div><div class="line">      tempParent = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</div><div class="line"></div><div class="line">      <span class="comment">// 属性转换为 camalCase 格式。</span></div><div class="line">      <span class="comment">// $.fn.prop 方法用到了</span></div><div class="line">      propMap = &#123;</div><div class="line">        <span class="string">'tabindex'</span>: <span class="string">'tabIndex'</span>,</div><div class="line">        <span class="string">'readonly'</span>: <span class="string">'readOnly'</span>,</div><div class="line">        <span class="string">'for'</span>: <span class="string">'htmlFor'</span>,</div><div class="line">        <span class="string">'class'</span>: <span class="string">'className'</span>,</div><div class="line">        <span class="string">'maxlength'</span>: <span class="string">'maxLength'</span>,</div><div class="line">        <span class="string">'cellspacing'</span>: <span class="string">'cellSpacing'</span>,</div><div class="line">        <span class="string">'cellpadding'</span>: <span class="string">'cellPadding'</span>,</div><div class="line">        <span class="string">'rowspan'</span>: <span class="string">'rowSpan'</span>,</div><div class="line">        <span class="string">'colspan'</span>: <span class="string">'colSpan'</span>,</div><div class="line">        <span class="string">'usemap'</span>: <span class="string">'useMap'</span>,</div><div class="line">        <span class="string">'frameborder'</span>: <span class="string">'frameBorder'</span>,</div><div class="line">        <span class="string">'contenteditable'</span>: <span class="string">'contentEditable'</span></div><div class="line">      &#125;,</div><div class="line">      <span class="comment">// 判断是否是arr的函数</span></div><div class="line">      isArray = <span class="built_in">Array</span>.isArray || <span class="function"><span class="keyword">function</span>(<span class="params">object</span>)</span>&#123; <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span> &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></div><div class="line">  <span class="comment">// 判断 element 是否符合 selector 的选择要求</span></div><div class="line">  zepto.matches = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</div><div class="line">    <span class="comment">// selector有值，element有值，element是普通DOM节点</span></div><div class="line">    <span class="keyword">if</span> (!selector || !element || element.nodeType !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span></div><div class="line"></div><div class="line">    <span class="comment">// elem.matchesSelector('.item') </span></div><div class="line">    <span class="comment">// 判断当前的 elem 是否符合传入的 selector 的要求 </span></div><div class="line">    <span class="keyword">var</span> matchesSelector = element.webkitMatchesSelector || </div><div class="line">                          element.mozMatchesSelector ||</div><div class="line">                          element.oMatchesSelector || </div><div class="line">                          element.matchesSelector</div><div class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.call(element, selector)</div><div class="line"></div><div class="line">    <span class="comment">// 浏览器不支持 matchesSelector</span></div><div class="line">    <span class="comment">// fall back to performing a selector:</span></div><div class="line">    <span class="keyword">var</span> match, </div><div class="line">        parent = element.parentNode, </div><div class="line">        temp = !parent</div><div class="line"></div><div class="line">    <span class="comment">// 上文定义 tempParent = document.createElement('div'),</span></div><div class="line">    <span class="comment">// 如果没有parent，parent赋值为一个div，然后将当前元素加入到这个div中</span></div><div class="line">    <span class="keyword">if</span> (temp) &#123;</div><div class="line">      parent = tempParent;</div><div class="line">      tempParent.appendChild(element);</div><div class="line">      <span class="comment">// (parent = tempParent).appendChild(element); 这种写法不易读</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 通过 qsa 获取匹配的元素，判断其中有没有 element</span></div><div class="line">    match = ~zepto.qsa(parent, selector).indexOf(element)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (temp) &#123;</div><div class="line">      <span class="comment">// 如果没有parent时，之前执行过  tempParent.appendChild(element);</span></div><div class="line">      <span class="comment">// 此时要移除子元素</span></div><div class="line">      tempParent.removeChild(element);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// temp &amp;&amp; tempParent.removeChild(element)  // 这种写法不易读</span></div><div class="line"></div><div class="line">    <span class="comment">// 返回最终的匹配结果，经过 qsa 判断的结果</span></div><div class="line">    <span class="keyword">return</span> match</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span> ? </div><div class="line">           <span class="built_in">String</span>(obj) :  <span class="comment">// null undefined</span></div><div class="line">           class2type[toString.call(obj)] || <span class="string">"object"</span> </div><div class="line"></div><div class="line">    <span class="comment">// 下文定义：</span></div><div class="line">    <span class="comment">// // Populate the class2type map</span></div><div class="line">    <span class="comment">// $.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name) &#123;</span></div><div class="line">    <span class="comment">//   class2type[ "[object " + name + "]" ] = name.toLowerCase()</span></div><div class="line">    <span class="comment">// &#125;)</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123; <span class="keyword">return</span> type(value) == <span class="string">"function"</span> &#125;</div><div class="line">  <span class="comment">// window的特点：window.window === window</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>)     </span>&#123; <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window &#125;</div><div class="line">  <span class="comment">// document.nodeType === 9</span></div><div class="line">  <span class="comment">// elem.DOCUMENT_NODE 也等于 9 （这里直接判断是不是9也行？？？）</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDocument</span>(<span class="params">obj</span>)   </span>&#123; <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)     </span>&#123; <span class="keyword">return</span> type(obj) == <span class="string">"object"</span> &#125;</div><div class="line">  <span class="comment">// 判断是否是最基本的object：Object.getPrototypeOf(obj) == Object.prototype</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 数组或者对象数组</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">typeof</span> obj.length == <span class="string">'number'</span> &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 筛选数组，踢出 null undefined 元素</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123; <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123; <span class="keyword">return</span> item != <span class="literal">null</span> &#125;) &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 下文定义：</span></div><div class="line">  <span class="comment">// $.fn = &#123;</span></div><div class="line">  <span class="comment">//    concat: emptyArray.concat,</span></div><div class="line">  <span class="comment">// $.fn.concat.apply([], array) —— 无论 array 是不是数组，都将返回一个数组，</span></div><div class="line">  <span class="comment">// 例如 $.fn.concat.call([], 'abc') 返回的是 ['abc']</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">array</span>) </span>&#123; <span class="keyword">return</span> array.length &gt; <span class="number">0</span> ? $.fn.concat.apply([], array) : array &#125;</div><div class="line"></div><div class="line">  <span class="comment">// camelize 已在上文定义</span></div><div class="line">  <span class="comment">// 用于 css 的 camalCase 转换，例如 background-color 转换为 backgroundColor</span></div><div class="line">  camelize = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123; <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, chr</span>)</span>&#123; <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">''</span> &#125;) &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 将 lineHeight 转换为 line-height 格式</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/::/g</span>, <span class="string">'/'</span>)</div><div class="line">              .replace(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">'$1_$2'</span>)</div><div class="line">              .replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">'$1_$2'</span>)</div><div class="line">              .replace(<span class="regexp">/_/g</span>, <span class="string">'-'</span>)</div><div class="line">              .toLowerCase()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// uniq变量已经在前面定义</span></div><div class="line">  <span class="comment">// 用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span></div><div class="line">  uniq = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>)</span>&#123; <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item, idx</span>)</span>&#123; <span class="keyword">return</span> array.indexOf(item) == idx &#125;) &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 上文定义 classCache = &#123;&#125;</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">classRE</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache ?</div><div class="line">           classCache[name] : </div><div class="line">           (classCache[name] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^|\\s)'</span> + name + <span class="string">'(\\s|$)'</span>))</div><div class="line"></div><div class="line">    <span class="comment">// classCache 存储的数据是这样的：</span></div><div class="line">    <span class="comment">// &#123;</span></div><div class="line">    <span class="comment">//   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</span></div><div class="line">    <span class="comment">//   xyz: /(^|\s)abc(\s|$)/,</span></div><div class="line">    <span class="comment">//   ...</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 传入一个 css 的 name 和 value，判断这个 value 是否需要增加 'px'</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maybeAddPx</span>(<span class="params">name, value</span>) </span>&#123;</div><div class="line">    <span class="comment">// dasherize(name) 将 lineHeight 转换为 line-height 格式</span></div><div class="line">    <span class="comment">// !cssNumber[dasherize(name)] 判断转换出来的 css name 是否再这个数组之外</span></div><div class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> value == <span class="string">"number"</span> &amp;&amp; !cssNumber[dasherize(name)]) ? </div><div class="line">           <span class="comment">// 如果 value 是数字，并且 name 不在 cssNumber 数组之内，就需要加 'px'，否则不需要</span></div><div class="line">           <span class="comment">// 例如 'width'、'font-size' 就需要加 'px'， 'font-weight' 就不需要加</span></div><div class="line">           value + <span class="string">"px"</span> : </div><div class="line">           value</div><div class="line"></div><div class="line">    <span class="comment">// 前文定义----------------------</span></div><div class="line">    <span class="comment">// cssNumber = &#123;</span></div><div class="line">    <span class="comment">//   'column-count': 1, </span></div><div class="line">    <span class="comment">//   'columns': 1, </span></div><div class="line">    <span class="comment">//   'font-weight': 1, </span></div><div class="line">    <span class="comment">//   'line-height': 1,</span></div><div class="line">    <span class="comment">//   'opacity': 1, </span></div><div class="line">    <span class="comment">//   'z-index': 1, </span></div><div class="line">    <span class="comment">//   'zoom': 1</span></div><div class="line">    <span class="comment">// &#125;,</span></div><div class="line">    <span class="comment">// function dasherize(str) &#123;</span></div><div class="line">    <span class="comment">//   return str.replace(/::/g, '/')</span></div><div class="line">    <span class="comment">//             .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></div><div class="line">    <span class="comment">//             .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></div><div class="line">    <span class="comment">//             .replace(/_/g, '-')</span></div><div class="line">    <span class="comment">//             .toLowerCase()</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 获取一个元素的默认 display 样式值，可能的结果是：inline block inline-block table .... （none 转换为 block）</span></div><div class="line">  <span class="comment">// $.fn.show 方法中用到了</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaultDisplay</span>(<span class="params">nodeName</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> element, display</div><div class="line"></div><div class="line">    <span class="comment">// 前文定义 elementDisplay = &#123;&#125;</span></div><div class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123;</div><div class="line"></div><div class="line">      <span class="comment">// 如果 elementDisplay 对象中，没有存储 nodeName 的信息</span></div><div class="line">      <span class="comment">// 则新建一个 nodeName 元素，添加到 body 中</span></div><div class="line">      element = <span class="built_in">document</span>.createElement(nodeName)</div><div class="line">      <span class="built_in">document</span>.body.appendChild(element)</div><div class="line">      <span class="comment">// 获取它的默认的 display 样式信息。</span></div><div class="line">      display = getComputedStyle(element, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>)</div><div class="line">      <span class="comment">// 接着马上移除元素！！！</span></div><div class="line">      element.parentNode.removeChild(element)</div><div class="line">      <span class="comment">// 'none' 换成 'block'，另外还可能是 'inline' 'inline-block' 'table' 等等...</span></div><div class="line">      display == <span class="string">"none"</span> &amp;&amp; (display = <span class="string">"block"</span>)</div><div class="line">      <span class="comment">// 存储下来</span></div><div class="line">      elementDisplay[nodeName] = display</div><div class="line"></div><div class="line">      <span class="comment">// 下文定义 </span></div><div class="line">      <span class="comment">// var nativeGetComputedStyle = getComputedStyle;</span></div><div class="line">      <span class="comment">// window.getComputedStyle = function(element)&#123;</span></div><div class="line">      <span class="comment">//   try &#123;</span></div><div class="line">      <span class="comment">//     return nativeGetComputedStyle(element)</span></div><div class="line">      <span class="comment">//   &#125; catch(e) &#123;</span></div><div class="line">      <span class="comment">//     return null</span></div><div class="line">      <span class="comment">//   &#125;</span></div><div class="line">      <span class="comment">// &#125;</span></div><div class="line">      <span class="comment">// 解释：</span></div><div class="line">      <span class="comment">// 如果浏览器支持 getComputedStyle 则使用，如果不支持，就返回 null</span></div><div class="line">      <span class="comment">// getComputedStyle(elem, '伪类，如 :link') 返回一个 CSSStyleDeclaration 对象，里面存储了元素的样式信息，可以通过 getPropertyValue('name') 方法获取</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 最终返回 display 结果</span></div><div class="line">    <span class="keyword">return</span> elementDisplay[nodeName]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 返回一个元素的子元素，数组形式</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">element</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 有些浏览器支持 elem.children 获取子元素，有些不支持</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'children'</span> <span class="keyword">in</span> element ?</div><div class="line"></div><div class="line">           <span class="comment">// 上文定义 slice = [].slice</span></div><div class="line">           <span class="comment">// slice.call(likeArr) 可以将对象数组转换为真正的数组</span></div><div class="line">           slice.call(element.children) :</div><div class="line"></div><div class="line">           <span class="comment">// 浏览器不支持 elem.children 只能通过 elem.childNodes 获取子元素</span></div><div class="line">           <span class="comment">// 只去 node.nodeType == 1 的子元素，通过 $.map 拼接成数组</span></div><div class="line">           <span class="comment">// $.map 下文定义的， $.map = function (elements, callback) &#123;....&#125;</span></div><div class="line">           <span class="comment">// $.map 作用：针对 elements（对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span></div><div class="line">           $.map(element.childNodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123; <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) <span class="keyword">return</span> node &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></div><div class="line">  <span class="comment">// 上文定义 zepto.matches = function(element, selector) &#123; /* 判断elem是否符合selector的要求 */ &#125;</span></div><div class="line"></div><div class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></div><div class="line">  <span class="comment">// to generate DOM nodes nodes from the given html string.</span></div><div class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></div><div class="line">  <span class="comment">// This function can be overriden in plugins for example to make</span></div><div class="line">  <span class="comment">// it compatible with browsers that don't support the DOM fully.</span></div><div class="line">  zepto.fragment = <span class="function"><span class="keyword">function</span>(<span class="params">html, name, properties</span>) </span>&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">      参数：</div><div class="line">      @html: 待处理的html字符串</div><div class="line">      @name: 通过 name 可在 containers 中查找容器节点，如果不传入，取得的容器默认为 div</div><div class="line">      @properties: 节点属性对象</div><div class="line">    */</div><div class="line"></div><div class="line">    <span class="keyword">var</span> dom, nodes, container</div><div class="line"></div><div class="line">    <span class="comment">// 上文定义：singleTagRE = /^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/,   // 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></div><div class="line">    <span class="comment">// 如果 html 是单标签，则直接用该标签创建元素</span></div><div class="line">    <span class="comment">// RegExp.$1 表示正则中的第一个括号匹配的内容，在此即 (\w+) 匹配的内容，</span></div><div class="line">    <span class="comment">// A special case optimization for a single tag</span></div><div class="line">    <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>))</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!dom) &#123;</div><div class="line">      <span class="comment">// 说明 html 不是单标签，dom未被赋值</span></div><div class="line"></div><div class="line">      <span class="comment">// 上文定义 tagExpanderRE = /&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig,   // 单标签</span></div><div class="line">      <span class="comment">// 将 &lt;p/&gt;或&lt;p /&gt;，替换为 &lt;p&gt;&lt;/p&gt;，将&lt;p abc/&gt;替换为&lt;p&gt;abc&lt;/p&gt;</span></div><div class="line">      <span class="comment">// &lt;input/&gt; （在 tagExpanderRE 中定义）的不替换</span></div><div class="line">      <span class="keyword">if</span> (html.replace) html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>)</div><div class="line"></div><div class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,   // 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></div><div class="line">      <span class="comment">// 如果 name 未传入，则赋值为 html 的第一个标签</span></div><div class="line">      <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span></div><div class="line"></div><div class="line">      <span class="comment">// 上文定义</span></div><div class="line">      <span class="comment">// // 指定特殊元素的 容器</span></div><div class="line">      <span class="comment">// containers = &#123;</span></div><div class="line">      <span class="comment">//   'tr': document.createElement('tbody'),</span></div><div class="line">      <span class="comment">//   'tbody': table, </span></div><div class="line">      <span class="comment">//   'thead': table, </span></div><div class="line">      <span class="comment">//   'tfoot': table,</span></div><div class="line">      <span class="comment">//   'td': tableRow, </span></div><div class="line">      <span class="comment">//   'th': tableRow,</span></div><div class="line">      <span class="comment">//   // 除了上面指定的，其他所有元素的容器都是 div</span></div><div class="line">      <span class="comment">//   '*': document.createElement('div')</span></div><div class="line">      <span class="comment">// &#125;,</span></div><div class="line">      <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">'*'</span></div><div class="line"></div><div class="line">      container = containers[name]</div><div class="line">      container.innerHTML = <span class="string">''</span> + html  <span class="comment">// 转变为字符串的快捷方式</span></div><div class="line"></div><div class="line">      <span class="comment">// 遍历 container 的子元素（先转换为数组形式）</span></div><div class="line">      <span class="comment">// 返回的同时，将每个子元素移除。</span></div><div class="line">      <span class="comment">// $.each 返回的是一个数组，因为第一个参数就是数组 slice.call(container.childNodes)</span></div><div class="line">      dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        container.removeChild(<span class="keyword">this</span>)</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 赋值属性</span></div><div class="line">    <span class="keyword">if</span> (isPlainObject(properties)) &#123;</div><div class="line">      <span class="comment">// 先将dom转换为 zepto 对象</span></div><div class="line">      nodes = $(dom)</div><div class="line"></div><div class="line">      $.each(properties, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</div><div class="line">        <span class="comment">// 上文定义：</span></div><div class="line">        <span class="comment">// // 应该通过方法调用来设置/获取的特殊属性</span></div><div class="line">        <span class="comment">// methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'],</span></div><div class="line">        <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) nodes[key](value)  <span class="comment">// 满足 methodAttributes 的，通过方法赋值</span></div><div class="line">        <span class="keyword">else</span> nodes.attr(key, value) <span class="comment">// 否则，通过属性复制</span></div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 最终返回的dom可能有两种形式</span></div><div class="line">    <span class="comment">// 第一，如果 html 是单标签，则dom被复制为一个zepto对象 dom = $(document.createElement(RegExp.$1))</span></div><div class="line">    <span class="comment">// 第二，如果 html 不是单标签，则dom被复制为一个DOM节点的数组</span></div><div class="line">    <span class="keyword">return</span> dom</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></div><div class="line">  <span class="comment">// 上文定义 zepto.matches = function(element, selector) &#123; /* 判断elem是否符合selector的要求 */ &#125;</span></div><div class="line">  <span class="comment">// 上文定义 zepto.fragment = function(html, name, properties) &#123; /* 通过html字符串获取文档碎片 */ &#125;</span></div><div class="line"></div><div class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></div><div class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></div><div class="line">  <span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></div><div class="line">  <span class="comment">// Explorer. This method can be overriden in plugins.</span></div><div class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</div><div class="line">    dom = dom || []</div><div class="line">    <span class="comment">// 将 dom 隐式原型强制改为 $.fn</span></div><div class="line">    <span class="comment">// 下文 zepto.Z.prototype = $.fn   因此，dom.__proto__ = $.fn 即 dom.__proto__ = zepto.Z.prototype  可以不较真的认为 zepto.Z 就是一个构造函数（但感觉这么设计，有些蹩脚）</span></div><div class="line">    dom.__proto__ = $.fn</div><div class="line">    dom.selector = selector || <span class="string">''</span></div><div class="line">    <span class="keyword">return</span> dom</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></div><div class="line">  <span class="comment">// collection. This method can be overriden in plugins.</span></div><div class="line">  zepto.isZ = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</div><div class="line">    <span class="comment">// 上文 dom.__proto__ = $.fn</span></div><div class="line">    <span class="comment">// 下文 zepto.Z.prototype = $.fn</span></div><div class="line">    <span class="comment">// 可知：dom.__proto__ === $.fn === zepto.Z.prototype</span></div><div class="line"></div><div class="line">    <span class="comment">// 因此，zepto对象都符合 object instanceof zepto.Z</span></div><div class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span></div><div class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></div><div class="line">  <span class="comment">// special cases).</span></div><div class="line">  <span class="comment">// This method can be overriden in plugins.</span></div><div class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> dom</div><div class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></div><div class="line">    <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z()</div><div class="line"></div><div class="line">    <span class="comment">// Optimize for string selectors</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'string'</span>) &#123;</div><div class="line">      <span class="comment">// 字符串的情况，一般有两种：</span></div><div class="line">      <span class="comment">// 第一，一段 html 代码，旨在通过zepto生成dom对象</span></div><div class="line">      <span class="comment">// 第二，一段查询字符串，旨在通过zepto查找dom对象</span></div><div class="line">      <span class="comment">// 将查询结果存储到 dom 变量中</span></div><div class="line"></div><div class="line">      selector = selector.trim()</div><div class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></div><div class="line">      <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></div><div class="line">      <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></div><div class="line"></div><div class="line">      <span class="comment">// 上文定义：</span></div><div class="line">      <span class="comment">// // 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></div><div class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,</span></div><div class="line">      <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector))</div><div class="line"></div><div class="line">        <span class="comment">// 第一，RegExp.$1取出来的就是第一个标签名称，即正则中 (\w+|!) 对应的内容</span></div><div class="line">        <span class="comment">// 第二，此时的 context 应该传入的是css属性对象（这里会产生歧义，老版的不会传入 context）</span></div><div class="line">        dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></div><div class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></div><div class="line">      <span class="comment">// nodes from there</span></div><div class="line"></div><div class="line">      <span class="comment">// 如果 selector 不是html字符串标签，并且 context 有值，则从context中查找</span></div><div class="line">      <span class="comment">// find 应该是在 $.fn 中定义的，有待解读？？？</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</div><div class="line">      <span class="comment">// If it's a CSS selector, use it to select nodes.</span></div><div class="line"></div><div class="line">      <span class="comment">// 除了以上情况，就从整个 document 执行 qsa 的查找</span></div><div class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// If a function is given, call it when the DOM is ready</span></div><div class="line">    <span class="comment">// 如果是函数，则dom ready时执行，</span></div><div class="line">    <span class="comment">// ready方法应该在 $.fn 中定义，有待解毒</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector)</div><div class="line"></div><div class="line">    <span class="comment">// If a Zepto collection is given, just return it</span></div><div class="line">    <span class="comment">// 传入的参数本身就已经是 zepto 对象，则直接返回</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">      <span class="comment">// compact函数：踢出数组中 == null 的元素</span></div><div class="line">      <span class="comment">// normalize array if an array of nodes is given</span></div><div class="line">      <span class="keyword">if</span> (isArray(selector)) dom = compact(selector)</div><div class="line"></div><div class="line">      <span class="comment">// 如果传入的是object，直接强制塞进一个数组</span></div><div class="line">      <span class="comment">// Wrap DOM nodes.</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector)) dom = [selector], selector = <span class="literal">null</span>  <span class="comment">// 及时清空 selector 不妨碍下面的判断</span></div><div class="line"></div><div class="line"></div><div class="line">      <span class="comment">// 从此往下，感觉和上文 selector 是字符串的情况下，重复了</span></div><div class="line">      <span class="comment">// ？？？？？？？？</span></div><div class="line"></div><div class="line"></div><div class="line">      <span class="comment">// fragmentRE.test 即判断字符串是否是 html 标签开头（即是否是html fragement）</span></div><div class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</div><div class="line">        <span class="comment">//此时，context 也是属性集合，不是容器！！！</span></div><div class="line">        <span class="comment">//（这里会产生歧义，老版的不会传入 context）</span></div><div class="line">        dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span> <span class="comment">// 及时清空 selector 不妨碍下面的判断</span></div><div class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></div><div class="line">      <span class="comment">// nodes from there</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</div><div class="line">      <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></div><div class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 最终，还是通过 zepto.Z 创建了对象</span></div><div class="line">    <span class="comment">// 这里的 dom，其实就是一个数组</span></div><div class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></div><div class="line">    <span class="keyword">return</span> zepto.Z(dom, selector)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></div><div class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></div><div class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></div><div class="line">  <span class="comment">// patchable in plugins.</span></div><div class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> zepto.init(selector, context)</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// $ 最终被这个匿名函数所返回，并复制给了全局的 Zepto 变量</span></div><div class="line">  <span class="comment">// 全局的 zepto 变量暴露给了 window，并且可能有一个别名—— $</span></div><div class="line">  <span class="comment">// 此 $ 非彼 $ </span></div><div class="line">  <span class="comment">// 对于初学者来说，这里肯定非常绕（还不如把这里的 $ 改改名字）</span></div><div class="line"></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</div><div class="line">    <span class="comment">// key 在上文已经定义，否则就污染全局变量了</span></div><div class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</div><div class="line"></div><div class="line">      <span class="comment">// 深度递归，首先必须 deep 参数为 true</span></div><div class="line">      <span class="comment">// 其次，source[key] 必须是数组或者对象，才有必要深度递归（否则没必要）</span></div><div class="line">      <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</div><div class="line"></div><div class="line">        <span class="comment">// source[key] 是对象，而 target[key] 不是对象</span></div><div class="line">        <span class="comment">// 则 target[key] = &#123;&#125; 初始化一下，否则递归会出错的</span></div><div class="line">        <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</div><div class="line">          target[key] = &#123;&#125;</div><div class="line"></div><div class="line">        <span class="comment">// source[key] 是数组，而 target[key] 不是数组</span></div><div class="line">        <span class="comment">// 则 target[key] = [] 初始化一下，否则递归会出错的</span></div><div class="line">        <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key]))</div><div class="line">          target[key] = []</div><div class="line"></div><div class="line">        <span class="comment">// 执行递归</span></div><div class="line">        extend(target[key], source[key], deep)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 不满足以上条件，说明 source[key] 是一般的值类型，直接赋值给 target 就是了</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></div><div class="line">  <span class="comment">// objects to the `target` object.</span></div><div class="line">  $.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</div><div class="line">    <span class="comment">// 一般传入的参数会是：</span></div><div class="line">    <span class="comment">// (targetObj, srcObj1, srcObj2, srcObj1...)</span></div><div class="line">    <span class="comment">// (true, targetObj, srcObj1, srcObj2, srcObj1...)</span></div><div class="line"></div><div class="line">    <span class="comment">// arguments 是对象数组，slice.call 会返回真正的数组（此处返回从第二项开始）</span></div><div class="line">    <span class="keyword">var</span> deep, args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">    <span class="comment">// 第一个参数是boolean，这里会把第二个参数当做 target，其他的作为 source</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">'boolean'</span>) &#123;</div><div class="line">      deep = target</div><div class="line">      target = args.shift()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 将所有的 source 添加到 target 中</span></div><div class="line">    args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123; extend(target, arg, deep) &#125;)</div><div class="line">    <span class="keyword">return</span> target</div><div class="line"></div><div class="line">    <span class="comment">// 感觉这样设计是比较好，很好的将业务和底层进行了分离（虽然比较简单）：</span></div><div class="line">    <span class="comment">// 核心方法再 function extend(...)&#123;...&#125; 中定义，</span></div><div class="line">    <span class="comment">// 而 $.extend 方法中做一些外围的判断和处理，最终调用 extend 函数去执行</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span></div><div class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></div><div class="line">  <span class="comment">// This method can be overriden in plugins.</span></div><div class="line">  zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>)</span>&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">      @element: 容器</div><div class="line">      @selector: 选择器</div><div class="line">    */</div><div class="line"></div><div class="line">    <span class="keyword">var</span> found,</div><div class="line">        maybeID = selector[<span class="number">0</span>] == <span class="string">'#'</span>,</div><div class="line">        maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">'.'</span>,</div><div class="line"></div><div class="line">        <span class="comment">// ID或class形式：返回 selector.slice(1) 即ID或者class的值</span></div><div class="line">        <span class="comment">// 否则：返回 selector，如通过 tagName 查询</span></div><div class="line">        nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></div><div class="line"></div><div class="line">        <span class="comment">// 是否是一个简单的字符串（可能是一个复杂的选择器，如 'div#div1 .item[link] .red'）</span></div><div class="line">        isSimple = simpleSelectorRE.test(nameOnly)</div><div class="line"></div><div class="line">    <span class="comment">// 上文定义：</span></div><div class="line">    <span class="comment">// // 匹配一个包括（字母、数组、下划线、-）的字符串</span></div><div class="line">    <span class="comment">// simpleSelectorRE = /^[\w-]*$/,</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// 以下代码的基本思路是：</span></div><div class="line">    <span class="comment">// 1. 优先通过 ID 获取元素；</span></div><div class="line">    <span class="comment">// 2. 然后试图通过 className 和 tagName 获取元素</span></div><div class="line">    <span class="comment">// 3. 最后通过 querySelectorAll 来获取</span></div><div class="line">    <span class="keyword">return</span> (isDocument(element) &amp;&amp; isSimple &amp;&amp; maybeID) ?</div><div class="line">           <span class="comment">// 这是最简单的形式：容器是document、选择器是一个id</span></div><div class="line">           <span class="comment">// 因为 getElementById 只能在 document 上用，所以这里单独拿出来</span></div><div class="line">           ( (found = element.getElementById(nameOnly)) ? </div><div class="line">              [found] : </div><div class="line">              [] </div><div class="line">           ) :</div><div class="line"></div><div class="line">           (element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span>) ? </div><div class="line">              <span class="comment">// 容器不是一般元素，也不是document，直接返回 []</span></div><div class="line">              [] :</div><div class="line"></div><div class="line">              <span class="comment">// 将获取的所有元素集合，都转换为数组</span></div><div class="line">              slice.call(</div><div class="line">                isSimple &amp;&amp; !maybeID </div><div class="line"></div><div class="line">                <span class="comment">// isSimple情况下，nameOnly 只可能是 className 或者 tagName</span></div><div class="line">                <span class="comment">// getElementsByClassName 和 getElementsByTagName 可以在 elem 上用，而且比 querySelectorAll 速度快</span></div><div class="line">                <span class="comment">// 所以，只要elem容器有值，尽量单独拿出来处理</span></div><div class="line">                ? </div><div class="line">                  maybeClass ? </div><div class="line">                  element.getElementsByClassName(nameOnly) : <span class="comment">// If it's simple, it could be a class</span></div><div class="line">                  element.getElementsByTagName(selector)  <span class="comment">// Or a tag</span></div><div class="line"></div><div class="line">                <span class="comment">// 最后其他情况，只能通过 querySelectorAll 来处理</span></div><div class="line">                : </div><div class="line">                element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></div><div class="line">              )</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 根据 selector 筛选 nodes </span></div><div class="line">  <span class="comment">// 并将 nodes 封装为 zepto 对象</span></div><div class="line">  <span class="comment">// $.fn.filter 下文定义</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">filtered</span>(<span class="params">nodes, selector</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> selector == <span class="literal">null</span> ? $(nodes) : $(nodes).filter(selector)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 判断 parent 是否包含 node</span></div><div class="line">  $.contains = <span class="built_in">document</span>.documentElement.contains ?</div><div class="line">    <span class="comment">// 浏览器支持 contains 方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> parent !== node &amp;&amp; parent.contains(node)</div><div class="line">    &#125; :</div><div class="line">    <span class="comment">// 不支持 contains 方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</div><div class="line">      <span class="keyword">while</span> (node &amp;&amp; (node = node.parentNode))</div><div class="line">        <span class="keyword">if</span> (node === parent) <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 如果 arg 是函数，则改变函数的执行环境和参数</span></div><div class="line">  <span class="comment">// 如果不是，直接返回 arg</span></div><div class="line">  <span class="comment">// $.fn.html 方法就用到了</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcArg</span>(<span class="params">context, arg, idx, payload</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> isFunction(arg) ? arg.call(context, idx, payload) : arg</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 设置属性</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAttribute</span>(<span class="params">node, name, value</span>) </span>&#123;</div><div class="line">    value == <span class="literal">null</span> ? node.removeAttribute(name) : node.setAttribute(name, value)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 设置或获取 node 的 className</span></div><div class="line">  <span class="comment">// 考虑 svg ？？？？</span></div><div class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">className</span>(<span class="params">node, value</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> klass = node.className || <span class="string">''</span>,</div><div class="line">        svg   = klass &amp;&amp; klass.baseVal !== <span class="literal">undefined</span></div><div class="line"></div><div class="line">    <span class="comment">// 获取</span></div><div class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.baseVal : klass</div><div class="line">    <span class="comment">// 设置</span></div><div class="line">    svg ? (klass.baseVal = value) : (node.className = value)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 将字符串变成响应的对象或者值，例如源代码的注释：</span></div><div class="line">  <span class="comment">// "true"  =&gt; true</span></div><div class="line">  <span class="comment">// "false" =&gt; false</span></div><div class="line">  <span class="comment">// "null"  =&gt; null</span></div><div class="line">  <span class="comment">// "42"    =&gt; 42</span></div><div class="line">  <span class="comment">// "42.5"  =&gt; 42.5</span></div><div class="line">  <span class="comment">// "08"    =&gt; "08"</span></div><div class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></div><div class="line">  <span class="comment">// String  =&gt; self</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deserializeValue</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="keyword">return</span> value ?</div><div class="line"></div><div class="line">        <span class="comment">// value『有值』的情况：</span></div><div class="line">        value == <span class="string">"true"</span> ||  <span class="comment">// 如果 value == 'true'，那么这个表达式本身就返回 true ，导致整个函数返回true</span></div><div class="line"></div><div class="line">          <span class="comment">// value !== 'true' 的情况：</span></div><div class="line">          ( </div><div class="line">            value == <span class="string">"false"</span> ? <span class="literal">false</span> : <span class="comment">// "null"  =&gt; null</span></div><div class="line">            value == <span class="string">"null"</span> ? <span class="literal">null</span> : <span class="comment">// "null"  =&gt; null</span></div><div class="line">            +value + <span class="string">""</span> == value ? +value :  <span class="comment">// 数字："42" =&gt; 42  "42.5" =&gt; 42.5  （ 但是 '08' 却不符合这个条件 ）</span></div><div class="line">            /^[\[\&#123;]/.test(value) ? $.parseJSON(value) : <span class="comment">// '[...]' 或者 '&#123;...&#125;'</span></div><div class="line">            value <span class="comment">// 其他</span></div><div class="line">          )</div><div class="line"></div><div class="line">        <span class="comment">// value『无值』的情况： undefined / '' / flase / 0 / null</span></div><div class="line">        : value </div><div class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</div><div class="line">      <span class="keyword">return</span> value</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 将上文定义的函数，暴露给 $ 对象（其实 $ 是一个 function）</span></div><div class="line">  $.type = type</div><div class="line">  $.isFunction = isFunction</div><div class="line">  $.isWindow = isWindow</div><div class="line">  $.isArray = isArray</div><div class="line">  $.isPlainObject = isPlainObject</div><div class="line"></div><div class="line">  $.isEmptyObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> name</div><div class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $.inArray = <span class="function"><span class="keyword">function</span>(<span class="params">elem, array, i</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $.camelCase = camelize</div><div class="line">  $.trim = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> str == <span class="literal">null</span> ? <span class="string">""</span> : <span class="built_in">String</span>.prototype.trim.call(str)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// plugin compatibility</span></div><div class="line">  $.uuid = <span class="number">0</span></div><div class="line">  $.support = &#123; &#125;</div><div class="line">  $.expr = &#123; &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 重新组织 elements 对象（数组、对象或者对象数组），针对每一个元素，都用 callback 进行检验</span></div><div class="line">  <span class="comment">// 检验通过后，将元素push进一个新数组，并返回</span></div><div class="line">  $.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> value, values = [], i, key</div><div class="line"></div><div class="line">    <span class="comment">// 数组，或者对象数组</span></div><div class="line">    <span class="keyword">if</span> (likeArray(elements))</div><div class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</div><div class="line">        <span class="comment">// 遍历，经过 callback 验证，push到结果中</span></div><div class="line">        value = callback(elements[i], i)</div><div class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 对象</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</div><div class="line">        <span class="comment">// 遍历，经过 callback 验证，push到结果中</span></div><div class="line">        value = callback(elements[key], key)</div><div class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 返回数组</span></div><div class="line">    <span class="comment">// flatten 函数上文定义的，作用：无论 values 是否是数组，都将返回一个正确的数组。例如，传入 'abc' ，返回 ['abc']</span></div><div class="line">    <span class="keyword">return</span> flatten(values)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 遍历 elements 所有元素（数组、对象数组、对象），执行 callback 方法，最终还是返回 elements</span></div><div class="line">  <span class="comment">// 注意1：callback.call(elements[i], i, elements[i]) 函数执行的环境和参数</span></div><div class="line">  <span class="comment">// 注意2：=== false) return elements 一旦有函数返回 false，即跳出循环，类似 break</span></div><div class="line">  <span class="comment">// 注意3：无论哪种情况，最终返回的还是 elements</span></div><div class="line">  $.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> i, key</div><div class="line">    <span class="keyword">if</span> (likeArray(elements)) &#123;</div><div class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</div><div class="line">        <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</div><div class="line">        <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> elements</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 上文定义：filter = emptyArray.filter</span></div><div class="line">  <span class="comment">// 筛选数组</span></div><div class="line">  $.grep = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> filter.call(elements, callback)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) $.parseJSON = <span class="built_in">JSON</span>.parse</div><div class="line"></div><div class="line">  <span class="comment">// Populate the class2type map</span></div><div class="line">  $.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</div><div class="line">    class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase()</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line">      上文将 class2type 赋值为 &#123;&#125;</div><div class="line">      最终将 class2type 赋值为：</div><div class="line">      &#123;</div><div class="line">        '[object boolean]': 'boolean',</div><div class="line">        '[object number]': 'number',</div><div class="line">        '[object string]': 'string',</div><div class="line">        ...</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      存储这个数据是为了方便的获取一些对象的类型，</div><div class="line">      例如 Object.prototype.toString.call([]) 返回的是 '[Object Array]'</div><div class="line">      那么即可根据这个获取 [] 的类型是 'array'</div><div class="line">    */</div><div class="line"></div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// Define methods that will be available on all</span></div><div class="line">  <span class="comment">// Zepto collections</span></div><div class="line">  $.fn = &#123;</div><div class="line"></div><div class="line">    <span class="comment">// 为何要这么多数组的方法？</span></div><div class="line">    <span class="comment">// 因为一个 zepto 对象，本身就是一个数组</span></div><div class="line"></div><div class="line">    <span class="comment">// Because a collection acts like an array</span></div><div class="line">    <span class="comment">// copy over these useful array functions.</span></div><div class="line">    forEach: emptyArray.forEach,</div><div class="line">    <span class="attr">reduce</span>: emptyArray.reduce,  <span class="comment">// 方法何用？？？？</span></div><div class="line">    push: emptyArray.push,</div><div class="line">    <span class="attr">sort</span>: emptyArray.sort,</div><div class="line">    <span class="attr">indexOf</span>: emptyArray.indexOf,</div><div class="line">    <span class="attr">concat</span>: emptyArray.concat,</div><div class="line"></div><div class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></div><div class="line">    <span class="comment">// from their array counterparts</span></div><div class="line">    map: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">      <span class="comment">// $.map 上文定义的， $.map = function (elements, callback) &#123;....&#125;</span></div><div class="line">      <span class="comment">// $.map 作用：针对 elements（对象、对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span></div><div class="line"></div><div class="line">      <span class="comment">// 最后，用 $ 封装返回</span></div><div class="line">      <span class="keyword">return</span> $(</div><div class="line">        <span class="comment">// $.map 返回的是一个数组</span></div><div class="line">        $.map(<span class="keyword">this</span>, </div><div class="line">          <span class="comment">// 针对每一个元素，都执行传入的函数，如果函数返回的 !=null 就将插入到新返回的数组</span></div><div class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">el, i</span>)</span>&#123; <span class="keyword">return</span> fn.call(el, i, el) &#125;</div><div class="line">        )</div><div class="line">      )</div><div class="line"></div><div class="line">      <span class="comment">/*</span></div><div class="line">        $('div').map(function(key, value)&#123;</div><div class="line">          return value.id;</div><div class="line">          // 或者 return this.id;</div><div class="line">        &#125;)</div><div class="line">        这个结果就是 $(['div1', 'div2' ...])</div><div class="line">      */</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">slice</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 直接数组的slice方法，并将结果用 $ 封装返回</span></div><div class="line">      <span class="keyword">return</span> $(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 在 zepto.init 函数中，当传入的函数是函数时，就用到了 ready </span></div><div class="line">    <span class="comment">// else if (isFunction(selector)) return $(document).ready(selector)</span></div><div class="line">    ready: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</div><div class="line">      <span class="comment">// need to check if document.body exists for IE as that browser reports</span></div><div class="line">      <span class="comment">// document ready when it hasn't yet created the body element</span></div><div class="line"></div><div class="line">      <span class="comment">// 下文定义：readyRE = /complete|loaded|interactive/,</span></div><div class="line">      <span class="keyword">if</span> (readyRE.test(<span class="built_in">document</span>.readyState) &amp;&amp; <span class="built_in">document</span>.body) callback($)</div><div class="line">      <span class="keyword">else</span> <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; callback($) &#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">      <span class="comment">// 返回当前对象</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span> ? </div><div class="line">             slice.call(<span class="keyword">this</span>) : <span class="comment">// 未传参数，直接返回一整个数组</span></div><div class="line">             <span class="comment">// 有参数，则试图返回单个元素（大于0，小于0 两种情况）</span></div><div class="line">             <span class="keyword">this</span>[</div><div class="line">                idx &gt;= <span class="number">0</span> ? </div><div class="line">                idx : </div><div class="line">                idx + <span class="keyword">this</span>.length</div><div class="line">            ]</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 将zepto集合变为纯数组</span></div><div class="line">    toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.get() &#125;,</div><div class="line"></div><div class="line">    <span class="attr">size</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 将元素从这个DOM树中移除</span></div><div class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parentNode != <span class="literal">null</span>)</div><div class="line">          <span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>)</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">each</span>: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</div><div class="line">      <span class="comment">// [].every ES5中Array的新特性。循环数组每个元素，返回是否符合callback函数的要求</span></div><div class="line"></div><div class="line">      <span class="comment">// every 函数返回的是 false 或者 true（不过这里返回什么无所谓，执行就可以了）</span></div><div class="line">      emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span></div><div class="line">      &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 最后返回本身对象</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">filter</span>: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="comment">// not函数下文定义</span></div><div class="line">      <span class="comment">// 如果给not传入的参数是函数，则返回不符合这个函数规则的元素的数组（用 $ 封装）</span></div><div class="line">      <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> <span class="keyword">this</span>.not(<span class="keyword">this</span>.not(selector))</div><div class="line"></div><div class="line">      <span class="comment">// 上文定义：zepto.matches 判断elements是否符合 selector 的要求</span></div><div class="line">      <span class="comment">// zepto.matches = function(element, selector) &#123;...&#125;</span></div><div class="line">      <span class="keyword">return</span> $(filter.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</div><div class="line">        <span class="comment">// 利用 [].filter 方法做筛选，利用 zepto.matches 做判断</span></div><div class="line">        <span class="keyword">return</span> zepto.matches(element, selector)</div><div class="line">      &#125;))</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// $('div') 可能只有三个 div 节点，那么 $('div').add('p') 再三个 div 节点的基础上，增加三个 p 节点</span></div><div class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">selector,context</span>)</span>&#123;</div><div class="line">      <span class="comment">// uniq函数——数组去重，例如：用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span></div><div class="line">      <span class="keyword">return</span> $(uniq(<span class="keyword">this</span>.concat($(selector,context))))</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">is</span>: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="comment">// 注意：这里只对 this[0] 第一个元素做判断了，其他的元素不管了</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span> &amp;&amp; zepto.matches(<span class="keyword">this</span>[<span class="number">0</span>], selector)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">not</span>: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> nodes=[] <span class="comment">// 存储最后返回的结果</span></div><div class="line"></div><div class="line">      <span class="comment">// 如果参数是函数</span></div><div class="line">      <span class="keyword">if</span> (isFunction(selector) &amp;&amp; selector.call !== <span class="literal">undefined</span>)</div><div class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">          <span class="comment">// 遍历对象的所有元素，对每个元素都执行传入的函数</span></div><div class="line">          <span class="comment">// 当函数返回 false 时（即不符合函数的规则），则将当前元素push到结果中，等待返回</span></div><div class="line">          <span class="keyword">if</span> (!selector.call(<span class="keyword">this</span>,idx)) nodes.push(<span class="keyword">this</span>)</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 如果参数不是函数</span></div><div class="line">      <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 为 excludes 赋值</span></div><div class="line">        <span class="keyword">var</span> excludes = </div><div class="line">          <span class="comment">// 如果 selector 是字符串（css选择器），则用filter过滤，将结果存储到 excludes 中</span></div><div class="line">          <span class="keyword">typeof</span> selector == <span class="string">'string'</span> ? <span class="keyword">this</span>.filter(selector) :</div><div class="line">          <span class="comment">// 如果 selector 不是字符串</span></div><div class="line">          <span class="comment">// 如果是数组或者对象数组（并且 selector.item 是函数？？？），则生成数组，赋值给 excludes</span></div><div class="line">          (likeArray(selector) &amp;&amp; isFunction(selector.item)) ? slice.call(selector) </div><div class="line">          <span class="comment">// 否则直接生成 zepto 对象，赋值给 excludes</span></div><div class="line">            : $(selector)</div><div class="line"></div><div class="line">        <span class="comment">// 至此，excludes 中就存储了通过 selector 查找出来的元素</span></div><div class="line"></div><div class="line">        <span class="comment">// [].forEach 是ES5的新特性</span></div><div class="line">        <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</div><div class="line">          <span class="comment">// 取出 excludes 中不包含的元素，push到结果中</span></div><div class="line">          <span class="keyword">if</span> (excludes.indexOf(el) &lt; <span class="number">0</span>) nodes.push(el)</div><div class="line">        &#125;)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 返回最后的结果，用 $ 封装</span></div><div class="line">      <span class="keyword">return</span> $(nodes)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">has</span>: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="comment">// 经过 filter 函数处理，返回的是一个处理后的值</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> isObject(selector) ?</div><div class="line">          <span class="comment">// 如果 seletor 是 object（可能是elem节点），则用 $.contains 判断</span></div><div class="line">          $.contains(<span class="keyword">this</span>, selector) :</div><div class="line">          <span class="comment">// 否则（selector是css选择字符串）则返回find后的size（如果 size === 0 即相当于返回 false）</span></div><div class="line">          $(<span class="keyword">this</span>).find(selector).size()</div><div class="line"></div><div class="line">          <span class="comment">// $.fn.find 在下文定义</span></div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">eq</span>: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">      <span class="comment">// 取出指定index的元素</span></div><div class="line">      <span class="comment">// 可支持 -1、0、1、2 ……</span></div><div class="line">      <span class="keyword">return</span> idx === <span class="number">-1</span> ? <span class="keyword">this</span>.slice(idx) : <span class="keyword">this</span>.slice(idx, + idx + <span class="number">1</span>)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">first</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="number">0</span>]</div><div class="line">      <span class="comment">// 不是 object 则直接返回</span></div><div class="line">      <span class="comment">// 是 object 类型，则用 $ 封装 （因为时刻都要支持链式操作！！！）</span></div><div class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">last</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="keyword">this</span>.length - <span class="number">1</span>]</div><div class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">find</span>: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="comment">// result 存储返回结果</span></div><div class="line">      <span class="keyword">var</span> result, $<span class="keyword">this</span> = <span class="keyword">this</span></div><div class="line"></div><div class="line">      <span class="comment">// 如果没有参数，就返回一个空的 zepto 对象</span></div><div class="line">      <span class="keyword">if</span> (!selector) result = $()</div><div class="line"></div><div class="line">      <span class="comment">// 如果selector是对象</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'object'</span>)</div><div class="line">        result = $(selector).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          <span class="keyword">var</span> node = <span class="keyword">this</span></div><div class="line">          <span class="keyword">return</span> emptyArray.some.call($<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> $.contains(parent, node)</div><div class="line">          &#125;)</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 如果 selector 不是对象（即是css选择器）：</span></div><div class="line"></div><div class="line">      <span class="comment">// 如果只有一个元素，则使用 qsa 判断，结果经过 $ 封装后赋值给 result</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length == <span class="number">1</span>) result = $(zepto.qsa(<span class="keyword">this</span>[<span class="number">0</span>], selector))</div><div class="line"></div><div class="line">      <span class="comment">// 如果有多个元素，则使用 map 遍历所有元素，使用 qsa 针对每个元素判断，符合条件即返回（map将返回包含符合条件的元素的新数组，并 $ 封装，支持链式操作！！）</span></div><div class="line">      <span class="keyword">else</span> result = <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> zepto.qsa(<span class="keyword">this</span>, selector) &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 返回最终结果</span></div><div class="line">      <span class="keyword">return</span> result</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 从元素本身开始，逐级向上级元素匹配，并返回最先匹配selector的元素</span></div><div class="line">    closest: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> node = <span class="keyword">this</span>[<span class="number">0</span>], collection = <span class="literal">false</span></div><div class="line"></div><div class="line">      <span class="comment">// 如果 selector 是对象，则用 $ 封装后，赋值给 collection</span></div><div class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'object'</span>) collection = $(selector)</div><div class="line"></div><div class="line">      <span class="keyword">while</span> (</div><div class="line">        <span class="comment">// while循环的判断条件：</span></div><div class="line">        <span class="comment">// 第一，node有值（node一开始被赋值为对象的第一个元素）</span></div><div class="line">        <span class="comment">// 第二，collection有值（传入的selector是对象）则collection包含node；collection无值（传入的selector是字符串，css选择），则node满足selector条件</span></div><div class="line">        <span class="comment">// 满足第一个条件，不满足第二条件，则循环继续（node试图赋值为node.parentNode）；否则，循环跳出（说明已经找到了符合条件的父节点）</span></div><div class="line">        node &amp;&amp; !(</div><div class="line">                    collection ? collection.indexOf(node) &gt;= <span class="number">0</span> : zepto.matches(node, selector)</div><div class="line">                )</div><div class="line">      )</div><div class="line">        <span class="comment">// node赋值成 node.parentNode</span></div><div class="line">        <span class="comment">// 前提条件是：node != context &amp;&amp; node 不是 document，如果是这两个条件之一，那就不继续赋值</span></div><div class="line">        node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode</div><div class="line"></div><div class="line">      <span class="comment">// 返回最终结果</span></div><div class="line">      <span class="keyword">return</span> $(node)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 获取对象集合每个元素所有的祖先元素。 $('h1').parents() =&gt; [&lt;div#container&gt;, &lt;body&gt;, &lt;html&gt;]</span></div><div class="line">    parents: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> ancestors = [], nodes = <span class="keyword">this</span></div><div class="line">      <span class="keyword">while</span> (nodes.length &gt; <span class="number">0</span>)</div><div class="line">        <span class="comment">// 可能需要执行多次 while 循环</span></div><div class="line">        <span class="comment">// 每次执行 $.map 函数都会对 nodes 重新赋值，然后再判断是否需要继续循环</span></div><div class="line">        <span class="comment">// 因为要获取每个元素的所有祖先元素，所以要多次循环</span></div><div class="line">        nodes = $.map(nodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</div><div class="line">          <span class="comment">// 使用 $.map（返回符合条件的元素的新数组，并用 $ 封装）遍历所有元素</span></div><div class="line">          <span class="keyword">if</span> ((node = node.parentNode) &amp;&amp; !isDocument(node) &amp;&amp; ancestors.indexOf(node) &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// 将符合条件的元素push到结果中</span></div><div class="line">            <span class="comment">// 条件：不能是 document，结果中元素不能重复。否则不执行push</span></div><div class="line">            ancestors.push(node)</div><div class="line"></div><div class="line">            <span class="comment">// 返回的 node ，将拼接出新数组，重新复制给 nodes，然后试图继续执行 while 循环</span></div><div class="line">            <span class="keyword">return</span> node</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 如果css选择器参数给出，过滤出符合条件的元素</span></div><div class="line">      <span class="keyword">return</span> filtered(ancestors, selector)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 获取对象集合中每个元素的直接父元素。如果css选择器参数给出。过滤出符合条件的元素。</span></div><div class="line">    parent: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="comment">// pluck 函数在下文定义</span></div><div class="line">      <span class="comment">// parent 函数，只获取第一级父节点即可</span></div><div class="line">      <span class="keyword">return</span> filtered(uniq(<span class="keyword">this</span>.pluck(<span class="string">'parentNode'</span>)), selector)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 获得每个匹配元素集合元素的直接子元素，可通过 selector 过滤</span></div><div class="line">    children: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> filtered(</div><div class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> children(<span class="keyword">this</span>) &#125;),  selector</div><div class="line">      )</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 获得每个匹配元素集合元素的子元素，包括文字和注释节点</span></div><div class="line">    contents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> slice.call(<span class="keyword">this</span>.childNodes) &#125;)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 获取对象集合中所有元素的兄弟节点，可通过 selector 过滤</span></div><div class="line">    siblings: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> filtered(<span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">i, el</span>)</span>&#123;</div><div class="line">        <span class="comment">// 获取兄弟节点</span></div><div class="line">        <span class="keyword">return</span> filter.call(children(el.parentNode), <span class="function"><span class="keyword">function</span>(<span class="params">child</span>)</span>&#123; <span class="keyword">return</span> child!==el &#125;)</div><div class="line">      &#125;), selector)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">empty</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.innerHTML = <span class="string">''</span> &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// `pluck` is borrowed from Prototype.js</span></div><div class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">property</span>)</span>&#123;</div><div class="line">      <span class="comment">// 获取自定义属性，返回值，拼接数组</span></div><div class="line">      <span class="keyword">return</span> $.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123; <span class="keyword">return</span> el[property] &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 返回当前对象，保证可链式操作</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// 第一步，针对内联样式，将 none 改为空字符串，如 &lt;p id="p2" style="display:none;"&gt;p2&lt;/p&gt;</span></div><div class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">''</span>)</div><div class="line"></div><div class="line">        <span class="comment">// 第二步，针对css样式，如果是 none 则修改为默认的显示样式</span></div><div class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</div><div class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName)</div><div class="line"></div><div class="line">        <span class="comment">// show 方法是为了显示对象，而对象隐藏的方式有两种：内联样式 或 css样式</span></div><div class="line">        <span class="comment">// this.style.display 只能获取内联样式的值（获取属性值）</span></div><div class="line">        <span class="comment">// getComputedStyle(this, '').getPropertyValue("display") 可以获取内联、css样式的值（获取 renderTree 的值）</span></div><div class="line">        <span class="comment">// 因此，这两步都要做判断，</span></div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">replaceWith</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newContent</span>)</span>&#123;</div><div class="line">      <span class="comment">// 先在前面插入，然后将当前对象移除</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.before(newContent).remove()</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">wrap</span>: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</div><div class="line">      <span class="comment">// 是否是函数</span></div><div class="line">      <span class="keyword">var</span> func = isFunction(structure)</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !func)</div><div class="line">        <span class="keyword">var</span> dom   = $(structure).get(<span class="number">0</span>),</div><div class="line">            <span class="comment">// 何时用 clone ？</span></div><div class="line">            <span class="comment">// 第一，dom.parentNode 说明 dom 在文档结构中，不 clone 就会被移动</span></div><div class="line">            <span class="comment">// 第二，this.length &gt; 1 说明当前对象有多个元素，每个元素都要添加，所有要clone</span></div><div class="line">            clone = dom.parentNode || <span class="keyword">this</span>.length &gt; <span class="number">1</span></div><div class="line"></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">        <span class="comment">// 借用 wrapAll 方法来做包装</span></div><div class="line">        $(<span class="keyword">this</span>).wrapAll(</div><div class="line">          func ? structure.call(<span class="keyword">this</span>, index) :</div><div class="line">            clone ? dom.cloneNode(<span class="literal">true</span>) : dom</div><div class="line">        )</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 在所有匹配元素外面包一个单独的结构</span></div><div class="line">    wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) &#123;</div><div class="line">        <span class="comment">// 先将 structure 插入到文档结构</span></div><div class="line">        $(<span class="keyword">this</span>[<span class="number">0</span>]).before(structure = $(structure))</div><div class="line"></div><div class="line">        <span class="keyword">var</span> children</div><div class="line">        <span class="comment">// drill down to the inmost element</span></div><div class="line">        <span class="comment">// 通过循环，将 structure 重新赋值为当前 structure 的最深处的一个子元素 </span></div><div class="line">        <span class="keyword">while</span> ((children = structure.children()).length) structure = children.first()</div><div class="line"></div><div class="line">        <span class="comment">// 将所有子元素都包裹进 structure</span></div><div class="line">        $(structure).append(<span class="keyword">this</span>)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 返回当前对象</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">wrapInner</span>: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</div><div class="line">      <span class="comment">// 是否是函数</span></div><div class="line">      <span class="keyword">var</span> func = isFunction(structure)</div><div class="line"></div><div class="line">      <span class="comment">// 返回对象自身，保证链式操作</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> self = $(<span class="keyword">this</span>), contents = self.contents(),</div><div class="line">            <span class="comment">// 是函数，即获取函数执行的返回结果；否则直接用 structure 参数</span></div><div class="line">            dom  = func ? structure.call(<span class="keyword">this</span>, index) : structure</div><div class="line"></div><div class="line">        <span class="comment">// 如果当前元素有内容，则通过内容 wrapAll。无内容，则直接用自身的 append 增加</span></div><div class="line">        contents.length ? contents.wrapAll(dom) : self.append(dom)</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">unwrap</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 通过 this.parent() 获取每个元素的父节点（集合）</span></div><div class="line">      <span class="comment">// 遍历这个父节点的集合</span></div><div class="line">      <span class="keyword">this</span>.parent().each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">// 将当前父节点替换为它的子节点</span></div><div class="line">        $(<span class="keyword">this</span>).replaceWith($(<span class="keyword">this</span>).children())</div><div class="line">      &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 返回对象自身，保证链式操作</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">clone</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 通过 this.map 循环对象，</span></div><div class="line">      <span class="comment">// 针对每个元素都返回它的clone         这个 this 和前面的 this 不一样</span></div><div class="line">      <span class="comment">// 返回新数组（用 $ 封装）</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.cloneNode(<span class="literal">true</span>) &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">hide</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>)</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 切换显示和隐藏</span></div><div class="line">    toggle: <span class="function"><span class="keyword">function</span>(<span class="params">setting</span>)</span>&#123;</div><div class="line">      <span class="comment">/*</span></div><div class="line">        @setting</div><div class="line">        true : 强制切换为 show</div><div class="line">        false : 强制切换为 hide</div><div class="line">      */</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> el = $(<span class="keyword">this</span>)</div><div class="line"></div><div class="line">        <span class="comment">// 条件判断：</span></div><div class="line">        <span class="comment">// 如果 setting === undefined 则看 el.css("display") == "none"</span></div><div class="line">        <span class="comment">// 如果 setting !== undefined 则看 !!setting</span></div><div class="line">        ;(setting === <span class="literal">undefined</span> ? el.css(<span class="string">"display"</span>) == <span class="string">"none"</span> : setting) ? </div><div class="line">        el.show() : <span class="comment">// 如果 true 则显示</span></div><div class="line">        el.hide() <span class="comment">// 如果 false 则隐藏</span></div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 借助 previousElementSibling 属性</span></div><div class="line">    prev: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">'previousElementSibling'</span>)).filter(selector || <span class="string">'*'</span>) &#125;,</div><div class="line">    <span class="comment">// 借助 nextElementSibling 属性</span></div><div class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">'nextElementSibling'</span>)).filter(selector || <span class="string">'*'</span>) &#125;,</div><div class="line">    <span class="attr">html</span>: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> </div><div class="line"></div><div class="line">        <span class="comment">// 情况1：有参数，赋值，并返回自身</span></div><div class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ? </div><div class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">          <span class="keyword">var</span> originHtml = <span class="keyword">this</span>.innerHTML</div><div class="line">          <span class="comment">// 传入的 html 参数允许是一个字符串，也允许是一个函数</span></div><div class="line">          <span class="comment">// 通过 funcArg 函数：</span></div><div class="line">          <span class="comment">//  1.如果 html 是字符串，则返回html</span></div><div class="line">          <span class="comment">//  2.如果 html 是函数，则执行执行函数（传入 idx、originHtml），返回函数执行结果</span></div><div class="line">          $(<span class="keyword">this</span>).empty().append( funcArg(<span class="keyword">this</span>, html, idx, originHtml) )</div><div class="line">        &#125;) :</div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line">          插播：</div><div class="line">          function funcArg(context, arg, idx, payload) &#123;</div><div class="line">            return isFunction(arg) ? arg.call(context, idx, payload) : arg</div><div class="line">          &#125;</div><div class="line">        */</div><div class="line"></div><div class="line">        <span class="comment">// 情况2：无参数，取值</span></div><div class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> ? </div><div class="line">          <span class="keyword">this</span>[<span class="number">0</span>].innerHTML : <span class="comment">// 直接取第一个元素的 innerHTML</span></div><div class="line">          <span class="literal">null</span></div><div class="line">        )</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">text</span>: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> </div><div class="line"></div><div class="line">        <span class="comment">// 情况1：有参数，赋值，并返回自身</span></div><div class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ?</div><div class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">          <span class="comment">// funcArg的应用，和html方法中一样</span></div><div class="line">          <span class="keyword">var</span> newText = funcArg(<span class="keyword">this</span>, text, idx, <span class="keyword">this</span>.textContent)</div><div class="line">          <span class="keyword">this</span>.textContent = newText == <span class="literal">null</span> ? <span class="string">''</span> : <span class="string">''</span>+newText</div><div class="line">        &#125;) :</div><div class="line"></div><div class="line">        <span class="comment">// 情况2：无参数，取值</span></div><div class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> ? <span class="keyword">this</span>[<span class="number">0</span>].textContent : <span class="literal">null</span>)  <span class="comment">// 直接借用 textContent 属性</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">attr</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> result</div><div class="line"></div><div class="line">      <span class="keyword">return</span> </div><div class="line"></div><div class="line">        <span class="comment">// 情况1：无第二个参数，读取值（读取值只能读取第一个元素的值）</span></div><div class="line">        (<span class="keyword">typeof</span> name == <span class="string">'string'</span> &amp;&amp; !(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>)) ?</div><div class="line">        (!<span class="keyword">this</span>.length || <span class="keyword">this</span>[<span class="number">0</span>].nodeType !== <span class="number">1</span> ? <span class="literal">undefined</span> :</div><div class="line">          <span class="comment">/*</span></div><div class="line">            注释：</div><div class="line">            this[0]是一个DOM节点，有『属性』也有『特性』</div><div class="line">              result = this[0].getAttribute(name) 试图获取 DOM节点属性</div><div class="line">              name in this[0] 判断是不是js对象的属性</div><div class="line">            然后，该返回哪一个就返回哪一个</div><div class="line">          */</div><div class="line">          (!(result = <span class="keyword">this</span>[<span class="number">0</span>].getAttribute(name)) &amp;&amp; name <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]) ? </div><div class="line">          <span class="keyword">this</span>[<span class="number">0</span>][name] : </div><div class="line">          result</div><div class="line">        ) :</div><div class="line"></div><div class="line">        <span class="comment">// 情况2：有第二个参数，设置值（针对每个元素设置值）</span></div><div class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType !== <span class="number">1</span>) <span class="keyword">return</span></div><div class="line"></div><div class="line">          <span class="comment">// 传入的参数可能是一个对象集合</span></div><div class="line">          <span class="comment">// 此时，是不是应该放在『情况1』当中？？？此时，value根本没有用啊？？？</span></div><div class="line">          <span class="keyword">if</span> (isObject(name)) <span class="keyword">for</span> (key <span class="keyword">in</span> name) setAttribute(<span class="keyword">this</span>, key, name[key])</div><div class="line"></div><div class="line">          <span class="comment">// 传入的不是对象，即设置一个单一的属性。</span></div><div class="line">          <span class="comment">// 但是，这里的 value 参数可以是一个函数</span></div><div class="line">          <span class="comment">// funcArg 即处理了 value 是函数和非函数的两种情况</span></div><div class="line">          <span class="keyword">else</span> setAttribute(<span class="keyword">this</span>, name, funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.getAttribute(name)))</div><div class="line">        &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">removeAttr</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </div><div class="line">          <span class="keyword">this</span>.nodeType === <span class="number">1</span> &amp;&amp; name.split(<span class="string">' '</span>).forEach(</div><div class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">attribute</span>)</span>&#123;</div><div class="line">              setAttribute(<span class="keyword">this</span>, attribute)  <span class="comment">// 将属性设置为空，setAttribute会移除属性</span></div><div class="line">            &#125;, </div><div class="line">            <span class="keyword">this</span> <span class="comment">// 改参数将成为 forEach 中函数的this</span></div><div class="line">          )</div><div class="line">        &#125;</div><div class="line">      )</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 读取、设置属性（js对象的属性）</span></div><div class="line">    prop: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</div><div class="line">      <span class="comment">// propMap 中存储的：key是html中的属性名称，value是js对象中的属性名称</span></div><div class="line">      <span class="comment">// 例如，html中的 "class" 在DOM对象中，就需要使用 "className" 这个名字读取，同理于：for  maxlength  cellspacing 等等</span></div><div class="line">      name = propMap[name] || name</div><div class="line"></div><div class="line">      <span class="comment">/*</span></div><div class="line">        上文定义：</div><div class="line">        propMap = &#123;</div><div class="line">          'tabindex': 'tabIndex',</div><div class="line">          'readonly': 'readOnly',</div><div class="line">          'for': 'htmlFor',</div><div class="line">          'class': 'className',</div><div class="line">          'maxlength': 'maxLength',</div><div class="line">          'cellspacing': 'cellSpacing',</div><div class="line">          'cellpadding': 'cellPadding',</div><div class="line">          'rowspan': 'rowSpan',</div><div class="line">          'colspan': 'colSpan',</div><div class="line">          'usemap': 'useMap',</div><div class="line">          'frameborder': 'frameBorder',</div><div class="line">          'contenteditable': 'contentEditable'</div><div class="line">        &#125;</div><div class="line">      */</div><div class="line"></div><div class="line">      <span class="keyword">return</span> </div><div class="line"></div><div class="line">        <span class="comment">// 有第二个参数，设置属性</span></div><div class="line">        (<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</div><div class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">          <span class="comment">// 设置属性值，funcArg处理函数或者非函数</span></div><div class="line">          <span class="keyword">this</span>[name] = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>[name])</div><div class="line">        &#125;) :</div><div class="line"></div><div class="line">        <span class="comment">// 无第二个参数，读取属性（读取第一个元素的）</span></div><div class="line">        (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>][name])</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 前面加上 'data-' 通过 attr 设置或者读取</span></div><div class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</div><div class="line">      <span class="comment">/*</span></div><div class="line">        上文定义：</div><div class="line">        capitalRE = /([A-Z])/g,  //大写字母</div><div class="line">      */</div><div class="line"></div><div class="line">      <span class="comment">//      前面加上 'data-'               将 'A' 替换为 '-a'</span></div><div class="line">      <span class="keyword">var</span> attrName = <span class="string">'data-'</span> + name.replace(capitalRE, <span class="string">'-$1'</span>).toLowerCase()</div><div class="line"></div><div class="line">      <span class="keyword">var</span> data = (<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</div><div class="line">        <span class="keyword">this</span>.attr(attrName, value) :</div><div class="line">        <span class="keyword">this</span>.attr(attrName)</div><div class="line"></div><div class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? deserializeValue(data) : <span class="literal">undefined</span></div><div class="line"></div><div class="line">      <span class="comment">/*</span></div><div class="line">        上文定义的，deserializeValue 函数的作用是：</div><div class="line"></div><div class="line">        // 将字符串变成响应的对象或者值，例如源代码的注释：</div><div class="line">        // "true"  =&gt; true</div><div class="line">        // "false" =&gt; false</div><div class="line">        // "null"  =&gt; null</div><div class="line">        // "42"    =&gt; 42</div><div class="line">        // "42.5"  =&gt; 42.5</div><div class="line">        // "08"    =&gt; "08"</div><div class="line">        // JSON    =&gt; parse if valid</div><div class="line">        // String  =&gt; self</div><div class="line">      */</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">val</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> </div><div class="line"></div><div class="line">        <span class="comment">// 有参数，设置值</span></div><div class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ?</div><div class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">          <span class="comment">// 遍历每个元素，直接对 value 属性赋值</span></div><div class="line">          <span class="keyword">this</span>.value = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.value)</div><div class="line">        &#125;) :</div><div class="line"></div><div class="line">        <span class="comment">// 无参数，读取值</span></div><div class="line">        (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; (</div><div class="line">           <span class="comment">// 如果元素是 &lt;select multiple&gt; 多选列表</span></div><div class="line">           <span class="keyword">this</span>[<span class="number">0</span>].multiple ?</div><div class="line">           <span class="comment">// 返回所有选中的option的值的数组</span></div><div class="line">           $(<span class="keyword">this</span>[<span class="number">0</span>]).find(<span class="string">'option'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.selected &#125;).pluck(<span class="string">'value'</span>) :</div><div class="line"></div><div class="line">                   <span class="comment">/*</span></div><div class="line">                      上文定义：</div><div class="line">                      pluck: function(property)&#123;</div><div class="line">                        return $.map(this, function(el)&#123; return el[property] &#125;)</div><div class="line">                      &#125;,</div><div class="line">                   */</div><div class="line"></div><div class="line">           <span class="comment">// 如果不是，直接获取 value</span></div><div class="line">           <span class="keyword">this</span>[<span class="number">0</span>].value</div><div class="line">          )</div><div class="line">        )</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 获取、设置元素的 offset</span></div><div class="line">    offset: <span class="function"><span class="keyword">function</span>(<span class="params">coordinates</span>)</span>&#123;</div><div class="line">      <span class="comment">// 如果有 coordinates 参数，设置坐标值，并返回当前对象</span></div><div class="line">      <span class="keyword">if</span> (coordinates) <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</div><div class="line">            <span class="comment">// 支持函数（传入 $this.offset() 做参数）和非函数</span></div><div class="line">            coords = funcArg(<span class="keyword">this</span>, coordinates, index, $<span class="keyword">this</span>.offset()),</div><div class="line">            <span class="comment">// 找到最近的 “relative”, “absolute” or “fixed” 的祖先元素，并获取它的 offset()</span></div><div class="line">            parentOffset = $<span class="keyword">this</span>.offsetParent().offset(),</div><div class="line">            <span class="comment">// left 和 top 需要去掉定位的祖先元素的 left、top 值</span></div><div class="line">            props = &#123;</div><div class="line">              <span class="attr">top</span>:  coords.top  - parentOffset.top,</div><div class="line">              <span class="attr">left</span>: coords.left - parentOffset.left</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        <span class="comment">// static时，设置 top、left是无效的</span></div><div class="line">        <span class="keyword">if</span> ($<span class="keyword">this</span>.css(<span class="string">'position'</span>) == <span class="string">'static'</span>) props[<span class="string">'position'</span>] = <span class="string">'relative'</span></div><div class="line"></div><div class="line">        <span class="comment">// 通过 css 赋值</span></div><div class="line">        $<span class="keyword">this</span>.css(props)</div><div class="line">      &#125;)</div><div class="line"></div><div class="line">      <span class="comment">// 当前对象是空，则返回 null</span></div><div class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="literal">null</span></div><div class="line"></div><div class="line">      <span class="comment">// 如果没有 coordinates 参数，则返回第一个元素的坐标值</span></div><div class="line">      <span class="keyword">var</span> obj = <span class="keyword">this</span>[<span class="number">0</span>].getBoundingClientRect()</div><div class="line">      <span class="comment">/*</span></div><div class="line">        elem.getBoundingClientRect() 返回一个对象，</div><div class="line">        包含元素的 top bottom left right width height 的值</div><div class="line">        但是这个 top、bottom、left、right 是相对于浏览器窗口的距离，而不是页面的边界</div><div class="line">        （注意，elem.getBoundingClientRect()在IE低版本浏览器有2px的兼容问题）</div><div class="line"></div><div class="line">        window.pageXOffset 和 window.pageYOffset 可获取网页滚动的距离，</div><div class="line">        IE低版本需要用 document.body.scrollLeft 和 document.body.scrollTop 兼容</div><div class="line">      */</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">left</span>: obj.left + <span class="built_in">window</span>.pageXOffset,</div><div class="line">        <span class="attr">top</span>: obj.top + <span class="built_in">window</span>.pageYOffset,</div><div class="line">        <span class="attr">width</span>: <span class="built_in">Math</span>.round(obj.width),</div><div class="line">        <span class="attr">height</span>: <span class="built_in">Math</span>.round(obj.height)</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 设置、获取 css</span></div><div class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">property, value</span>)</span>&#123;</div><div class="line"></div><div class="line">      <span class="comment">// 只有一个参数，获取第一个元素的样式</span></div><div class="line">      <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">var</span> computedStyle, element = <span class="keyword">this</span>[<span class="number">0</span>]</div><div class="line">        <span class="keyword">if</span>(!element) <span class="keyword">return</span>  <span class="comment">// 如果第一个元素无值，直接返回。否则继续</span></div><div class="line"></div><div class="line">        <span class="comment">// 获取元素的计算后的样式</span></div><div class="line">        computedStyle = getComputedStyle(element, <span class="string">''</span>)</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> property == <span class="string">'string'</span>)</div><div class="line">          <span class="comment">// 情况1，参数为字符串形式</span></div><div class="line">          <span class="comment">// 先从elem内联样式获取（element.style），此时需要 camelize(property) 转换，如将 background-color 变为 backgroundColor</span></div><div class="line">          <span class="comment">// 如果未找到，则从css样式获取 computedStyle.getPropertyValue(property) </span></div><div class="line">          <span class="comment">// （重要）注释：elem.style 只能获取元素设置的内联样式、不能获取css样式；而 getComputedStyle 可获取内联、css样式。</span></div><div class="line">          <span class="keyword">return</span> element.style[camelize(property)] || computedStyle.getPropertyValue(property)</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (isArray(property)) &#123;</div><div class="line">          <span class="comment">// 情况2，参数为数组形式（注意，此时 isObject 情况尚未判断）</span></div><div class="line">          <span class="keyword">var</span> props = &#123;&#125;</div><div class="line">          $.each(property, <span class="function"><span class="keyword">function</span>(<span class="params">_, prop</span>)</span>&#123;</div><div class="line">            props[prop] = (element.style[camelize(prop)] || computedStyle.getPropertyValue(prop))</div><div class="line">          &#125;)</div><div class="line">          <span class="keyword">return</span> props  <span class="comment">// 返回一个对象</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 其他情况：有两个参数、property是对象</span></div><div class="line">      <span class="keyword">var</span> css = <span class="string">''</span></div><div class="line">      <span class="keyword">if</span> (type(property) == <span class="string">'string'</span>) &#123;</div><div class="line">        <span class="comment">// 情况1，property 是字符串，设置单个样式</span></div><div class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>)</div><div class="line">          <span class="comment">// 如果value参数是 '' null undefined 则移除这个css样式</span></div><div class="line">          <span class="comment">// 注：此计算只适用于内联样式的删除，对 css 样式无效，因为它只通过 this.style.removeProperty 计算，而 this.style 获取不到css样式</span></div><div class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.removeProperty(dasherize(property)) &#125;)</div><div class="line">        <span class="keyword">else</span></div><div class="line">          <span class="comment">// value有正常值，将 css 生成一个字符串（如 'font-size:20px'）等待赋值给内联样式</span></div><div class="line">          <span class="comment">// maybeAddPx(property, value) 需要增加 px 的增加上</span></div><div class="line">          css = dasherize(property) + <span class="string">":"</span> + maybeAddPx(property, value)</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 情况2，property 是对象（此时就不管第二个参数是什么了，不用第二个参数），一次性设置多个样式</span></div><div class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</div><div class="line">          <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</div><div class="line">            <span class="comment">// 如果对象属性值是 '' null undefined 则移除这个css样式，同理，只针对内联样式</span></div><div class="line">            <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.removeProperty(dasherize(key)) &#125;)</div><div class="line">          <span class="keyword">else</span></div><div class="line">            <span class="comment">// 否则，给 css 赋值一个字符串，多样式属性用 ; 隔开</span></div><div class="line">            css += dasherize(key) + <span class="string">':'</span> + maybeAddPx(key, property[key]) + <span class="string">';'</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 针对每个元素，设置内联样式（this.style.cssText可获取、设置内联样式）</span></div><div class="line">      <span class="comment">// 最后返回自身</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.cssText += <span class="string">';'</span> + css &#125;)</div><div class="line"></div><div class="line">      <span class="comment">/*</span></div><div class="line">        上文定义：</div><div class="line">        // 将 lineHeight 转换为 line-height 格式</div><div class="line">        function dasherize(str) &#123;</div><div class="line">          return str.replace(/::/g, '/')</div><div class="line">                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</div><div class="line">                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')</div><div class="line">                    .replace(/_/g, '-')</div><div class="line">                    .toLowerCase()</div><div class="line">        &#125;</div><div class="line">      */</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 获取一个元素的索引值（从0开始计数）。当elemen参数没有给出时，返回当前元素在兄弟节点中的位置</span></div><div class="line">    index: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</div><div class="line">      <span class="comment">/*</span></div><div class="line">        上文定义：</div><div class="line">        $.fn.indexOf: emptyArray.indexOf</div><div class="line">      */</div><div class="line"></div><div class="line">      <span class="comment">// 其实 this 本身就是一个数组，数组本身就有 indexOf ，为何还要上文的这个赋值呢？</span></div><div class="line">      <span class="comment">// 因为上文中，this.__proto__ 修改了，不是 Array.prototype 了，也就没有 indexOf 方法了</span></div><div class="line">      <span class="comment">// 因此要手动赋值，需要将数组常用的方法在重新赋值给 $.fn.indexOf</span></div><div class="line"></div><div class="line">      <span class="keyword">return</span> element ? <span class="keyword">this</span>.indexOf($(element)[<span class="number">0</span>]) : <span class="keyword">this</span>.parent().children().indexOf(<span class="keyword">this</span>[<span class="number">0</span>])</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">hasClass</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">      <span class="keyword">return</span> emptyArray.some.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</div><div class="line">        <span class="comment">// this 就是 classRE(name) 的返回值（返回一个正则）</span></div><div class="line">        <span class="comment">// function className(node, value)&#123;...&#125; 获取或者设置elem的className</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.test(className(el))</div><div class="line">      &#125;, classRE(name))</div><div class="line"></div><div class="line">      <span class="comment">// array.some(callback,[ thisObject]); 只要数组中一项符合callback要求，即返回true</span></div><div class="line"></div><div class="line">      <span class="comment">/*</span></div><div class="line">        // 上文定义 classCache = &#123;&#125;</div><div class="line">        function classRE(name) &#123;</div><div class="line">          return name in classCache ?</div><div class="line">                 classCache[name] : </div><div class="line">                 (classCache[name] = new RegExp('(^|\\s)' + name + '(\\s|$)'))</div><div class="line"></div><div class="line">          // classCache 存储的数据是这样的：</div><div class="line">          // &#123;</div><div class="line">          //   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</div><div class="line">          //   xyz: /(^|\s)abc(\s|$)/,</div><div class="line">          //   ...</div><div class="line">          // &#125;</div><div class="line">        &#125;</div><div class="line">      */</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">addClass</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line"></div><div class="line">      <span class="comment">// 针对所有元素都添加className，最终返回本身</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">        <span class="comment">// 说明当前元素不是 DOM node</span></div><div class="line">        <span class="keyword">if</span> (!(<span class="string">'className'</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span></div><div class="line"></div><div class="line">        <span class="comment">// classList 是一开始就定义的空变量</span></div><div class="line">        classList = []</div><div class="line">        <span class="comment">// 获取元素的 clasname      // 支持传入函数</span></div><div class="line">        <span class="keyword">var</span> cls = className(<span class="keyword">this</span>), newName = funcArg(<span class="keyword">this</span>, name, idx, cls)</div><div class="line">        <span class="comment">// 把要赋值的值，按照空白分组，遍历</span></div><div class="line">        newName.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</div><div class="line">          <span class="comment">// 把当前元素不存在的class，push到classlist中</span></div><div class="line">          <span class="keyword">if</span> (!$(<span class="keyword">this</span>).hasClass(klass)) classList.push(klass)</div><div class="line">        &#125;, <span class="keyword">this</span>)</div><div class="line">        <span class="comment">// 如果classlist有数据，则为当前元素赋值最新的class值（现有的classname和新的classname拼接）</span></div><div class="line">        classList.length &amp;&amp; className(<span class="keyword">this</span>, cls + (cls ? <span class="string">" "</span> : <span class="string">""</span>) + classList.join(<span class="string">" "</span>))</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">removeClass</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">      <span class="comment">// 针对所有元素都移除className，最终返回本身</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">        <span class="comment">// 说明当前元素不是 DOM node</span></div><div class="line">        <span class="keyword">if</span> (!(<span class="string">'className'</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span></div><div class="line"></div><div class="line">        <span class="comment">// 如果参数空，则移除元素的所有class</span></div><div class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> className(<span class="keyword">this</span>, <span class="string">''</span>)</div><div class="line"></div><div class="line">        <span class="comment">// 获取现有的classname</span></div><div class="line">        classList = className(<span class="keyword">this</span>)</div><div class="line">        <span class="comment">// （可以传入函数）遍历新的classname字符串</span></div><div class="line">        funcArg(<span class="keyword">this</span>, name, idx, classList).split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</div><div class="line">          <span class="comment">// classRE(klass) 返回一个正则，匹配 'classname' 或 ' classname ' 或 ' classname' 或 'classname '</span></div><div class="line">          <span class="comment">// 针对传入的classname字符串，对每个符合条件的classname，都替换为 ' '（即删除了）</span></div><div class="line">          classList = classList.replace(classRE(klass), <span class="string">" "</span>)</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="comment">// 对整理好的classname，重新赋值给当前元素</span></div><div class="line">        className(<span class="keyword">this</span>, classList.trim())</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">toggleClass</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name, when</span>)</span>&#123;</div><div class="line">      <span class="comment">// when 参数相当于一个条件：</span></div><div class="line">      <span class="comment">// 如果 when === true 则单纯执行 addClass</span></div><div class="line">      <span class="comment">// 如果 when === false 则单纯执行 removeClass</span></div><div class="line"></div><div class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">        <span class="comment">//                   name 可接收函数，可以是空白分割开来的多个classname</span></div><div class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>), names = funcArg(<span class="keyword">this</span>, name, idx, className(<span class="keyword">this</span>))</div><div class="line">        <span class="comment">// 用空白分割开多个class</span></div><div class="line">        names.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</div><div class="line">          <span class="comment">// 如果有 when 参数，则只通过when参数判断，true则只执行addClass，false则只执行removeClass</span></div><div class="line">          <span class="comment">// 如果没有 when 参数，则判断元素有没有该class，有则移除，没有则添加</span></div><div class="line">          (when === <span class="literal">undefined</span> ? !$<span class="keyword">this</span>.hasClass(klass) : when) ?</div><div class="line">            $<span class="keyword">this</span>.addClass(klass) : $<span class="keyword">this</span>.removeClass(klass)</div><div class="line">        &#125;)</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">scrollTop</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></div><div class="line"></div><div class="line">      <span class="comment">// 普通elem有 scrollTop 属性，可以获取或者设置top值</span></div><div class="line">      <span class="comment">// window对象没有 scrollTop 属性，通过 pageYOffset 获取，通过 scrollTo() 赋值</span></div><div class="line"></div><div class="line">      <span class="keyword">var</span> hasScrollTop = <span class="string">'scrollTop'</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</div><div class="line">      <span class="comment">// value 无值，获取 top</span></div><div class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> hasScrollTop ? <span class="keyword">this</span>[<span class="number">0</span>].scrollTop : <span class="keyword">this</span>[<span class="number">0</span>].pageYOffset</div><div class="line">      <span class="comment">// value 有值，设置 top</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(hasScrollTop ?</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTop = value &#125; :</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTo(<span class="keyword">this</span>.scrollX, value) &#125;)   <span class="comment">// window.scrollX 获取横向滚动值</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">scrollLeft</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></div><div class="line">      <span class="keyword">var</span> hasScrollLeft = <span class="string">'scrollLeft'</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</div><div class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> hasScrollLeft ? <span class="keyword">this</span>[<span class="number">0</span>].scrollLeft : <span class="keyword">this</span>[<span class="number">0</span>].pageXOffset</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(hasScrollLeft ?</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollLeft = value &#125; :</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTo(value, <span class="keyword">this</span>.scrollY) &#125;)   <span class="comment">// window.scrollX 获取纵向滚动值</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">position</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></div><div class="line"></div><div class="line">      <span class="keyword">var</span> elem = <span class="keyword">this</span>[<span class="number">0</span>],</div><div class="line">        <span class="comment">// Get *real* offsetParent</span></div><div class="line">        offsetParent = <span class="keyword">this</span>.offsetParent(),  <span class="comment">// 找到第一个定位过的祖先元素 “relative”, “absolute” or “fixed”</span></div><div class="line">        <span class="comment">// Get correct offsets</span></div><div class="line">        offset       = <span class="keyword">this</span>.offset(), <span class="comment">// 获取自身的offset</span></div><div class="line">        parentOffset = rootNodeRE.test(offsetParent[<span class="number">0</span>].nodeName) ? &#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125; : offsetParent.offset()  <span class="comment">// 获取定位祖先元素的offset（ body、html直接设置 top:0;left:0 ）</span></div><div class="line">      <span class="comment">// 上文定义： rootNodeRE = /^(?:body|html)$/i,</span></div><div class="line"></div><div class="line">      <span class="comment">// 去掉当前元素的 margin 宽度</span></div><div class="line">      <span class="comment">// Subtract element margins</span></div><div class="line">      <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></div><div class="line">      <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></div><div class="line">      offset.top  -= <span class="built_in">parseFloat</span>( $(elem).css(<span class="string">'margin-top'</span>) ) || <span class="number">0</span></div><div class="line">      offset.left -= <span class="built_in">parseFloat</span>( $(elem).css(<span class="string">'margin-left'</span>) ) || <span class="number">0</span></div><div class="line"></div><div class="line">      <span class="comment">// 增加父元素的 border 宽度</span></div><div class="line">      <span class="comment">// Add offsetParent borders</span></div><div class="line">      parentOffset.top  += <span class="built_in">parseFloat</span>( $(offsetParent[<span class="number">0</span>]).css(<span class="string">'border-top-width'</span>) ) || <span class="number">0</span></div><div class="line">      parentOffset.left += <span class="built_in">parseFloat</span>( $(offsetParent[<span class="number">0</span>]).css(<span class="string">'border-left-width'</span>) ) || <span class="number">0</span></div><div class="line"></div><div class="line">      <span class="comment">// Subtract the two offsets</span></div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">top</span>:  offset.top  - parentOffset.top,</div><div class="line">        <span class="attr">left</span>: offset.left - parentOffset.left</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">offsetParent</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="comment">// 通过 this.map 遍历当前对象所有元素，进行计算，然后拼接新的数组，并返回。保证链式操作</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> parent = <span class="keyword">this</span>.offsetParent || <span class="built_in">document</span>.body  <span class="comment">// elem.offsetParent 可返回最近的改元素最近的已经定位的父元素</span></div><div class="line">        <span class="keyword">while</span> (parent &amp;&amp; !rootNodeRE.test(parent.nodeName) &amp;&amp; $(parent).css(<span class="string">"position"</span>) == <span class="string">"static"</span>)</div><div class="line">          <span class="comment">// 如果获取的parent不是null、不是body或html、而且position==static</span></div><div class="line">          <span class="comment">// 则继续向上查找 offsetParent、大不了找到 body 为止</span></div><div class="line">          parent = parent.offsetParent</div><div class="line"></div><div class="line">        <span class="comment">// 最后返回改元素</span></div><div class="line">        <span class="keyword">return</span> parent</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// for now</span></div><div class="line">  $.fn.detach = $.fn.remove</div><div class="line"></div><div class="line">  <span class="comment">// Generate the `width` and `height` functions</span></div><div class="line">  ;[<span class="string">'width'</span>, <span class="string">'height'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dimension</span>)</span>&#123;</div><div class="line">    <span class="comment">// 将 width height 变为  Width Height</span></div><div class="line">    <span class="keyword">var</span> dimensionProperty =</div><div class="line">      dimension.replace(<span class="regexp">/./</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>)</span>&#123; <span class="keyword">return</span> m[<span class="number">0</span>].toUpperCase() &#125;)</div><div class="line"></div><div class="line">    $.fn[dimension] = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> offset, el = <span class="keyword">this</span>[<span class="number">0</span>]</div><div class="line"></div><div class="line">      <span class="comment">// 情况1，无参数，获取第一个元素的值</span></div><div class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> isWindow(el) ? el[<span class="string">'inner'</span> + dimensionProperty] :  <span class="comment">// window.innerHeight</span></div><div class="line">        isDocument(el) ? el.documentElement[<span class="string">'scroll'</span> + dimensionProperty] :  <span class="comment">// document.documentElement.scrollHeight</span></div><div class="line">        (offset = <span class="keyword">this</span>.offset()) &amp;&amp; offset[dimension]  <span class="comment">// this.offset().width</span></div><div class="line"></div><div class="line">      <span class="comment">// 情况2，有参数，设置所有元素的值</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</div><div class="line">        el = $(<span class="keyword">this</span>)</div><div class="line">        <span class="comment">// 通过 css() 方法设置，支持传入函数</span></div><div class="line">        el.css(dimension, funcArg(<span class="keyword">this</span>, value, idx, el[dimension]()))</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// 针对当前元素、遍历子元素，都执行 fun 函数</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, fun</span>) </span>&#123;</div><div class="line">    fun(node)</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = node.childNodes.length; i &lt; len; i++)</div><div class="line">      traverseNode(node.childNodes[i], fun)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 上文定义 adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ],</span></div><div class="line"></div><div class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></div><div class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></div><div class="line">  adjacencyOperators.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span> <span class="comment">//=&gt; prepend, append</span></div><div class="line"></div><div class="line">    $.fn[operator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></div><div class="line">      <span class="keyword">var</span> argType, nodes = $.map(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</div><div class="line">            argType = type(arg)</div><div class="line">            <span class="keyword">return</span> argType == <span class="string">"object"</span> || argType == <span class="string">"array"</span> || arg == <span class="literal">null</span> ?</div><div class="line">              arg : zepto.fragment(arg)</div><div class="line">          &#125;),</div><div class="line">          parent, copyByClone = <span class="keyword">this</span>.length &gt; <span class="number">1</span></div><div class="line">      <span class="keyword">if</span> (nodes.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line"></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, target</span>)</span>&#123;</div><div class="line">        parent = inside ? target : target.parentNode</div><div class="line"></div><div class="line">        <span class="comment">// convert all methods to a "before" operation</span></div><div class="line">        target = operatorIndex == <span class="number">0</span> ? target.nextSibling :</div><div class="line">                 operatorIndex == <span class="number">1</span> ? target.firstChild :</div><div class="line">                 operatorIndex == <span class="number">2</span> ? target :</div><div class="line">                 <span class="literal">null</span></div><div class="line"></div><div class="line">        <span class="keyword">var</span> parentInDocument = $.contains(<span class="built_in">document</span>.documentElement, parent)</div><div class="line"></div><div class="line">        nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</div><div class="line">          <span class="keyword">if</span> (copyByClone) node = node.cloneNode(<span class="literal">true</span>)</div><div class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).remove()</div><div class="line"></div><div class="line">          parent.insertBefore(node, target)</div><div class="line">          <span class="keyword">if</span> (parentInDocument) traverseNode(node, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span> (el.nodeName != <span class="literal">null</span> &amp;&amp; el.nodeName.toUpperCase() === <span class="string">'SCRIPT'</span> &amp;&amp;</div><div class="line">               (!el.type || el.type === <span class="string">'text/javascript'</span>) &amp;&amp; !el.src)</div><div class="line">              <span class="built_in">window</span>[<span class="string">'eval'</span>].call(<span class="built_in">window</span>, el.innerHTML)</div><div class="line">          &#125;)</div><div class="line">        &#125;)</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// after    =&gt; insertAfter</span></div><div class="line">    <span class="comment">// prepend  =&gt; prependTo</span></div><div class="line">    <span class="comment">// before   =&gt; insertBefore</span></div><div class="line">    <span class="comment">// append   =&gt; appendTo</span></div><div class="line">    $.fn[inside ? operator+<span class="string">'To'</span> : <span class="string">'insert'</span>+(operatorIndex ? <span class="string">'Before'</span> : <span class="string">'After'</span>)] = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</div><div class="line">      $(html)[operator](<span class="keyword">this</span>)</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  zepto.Z.prototype = $.fn</div><div class="line"></div><div class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></div><div class="line">  zepto.uniq = uniq</div><div class="line">  zepto.deserializeValue = deserializeValue</div><div class="line">  $.zepto = zepto</div><div class="line"></div><div class="line">  <span class="keyword">return</span> $</div><div class="line">&#125;)()</div><div class="line"></div><div class="line"><span class="built_in">window</span>.Zepto = Zepto</div><div class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2016/11/12/JavaScript/深入理解javascript/51深入理解J avaScript 系列（结局篇）/" class="prev">PREV</a><a href="/2016/10/08/工具类/eslint配置/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://github.com/xuhongbo" target="_blank">xuhongbo-github</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>