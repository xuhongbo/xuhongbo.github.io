<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> AMD之require.js · xuhongbo</title><meta name="description" content="AMD之require.js - xuhongbo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://xuhongbo.com/atom.xml" title="xuhongbo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章列表</a></li><li class="nav-list-item"><a href="https://github.com/xuhongbo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/abstract/" target="_self" class="nav-list-link">个人简介</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">AMD之require.js</h1><div class="post-info">Jan 26, 2017</div><div class="post-content"><p>首先说一下，这篇文章是之前我一个好友给我的文档，并非原创 如有侵权请联系 <a href="xuhongbo@outlook.com">个人邮箱</a></p>
<p>还有就是如果问我为什么不分享CMD的，我感觉sea.js的中文社区很活跃，还有就是玉伯的sea.js中的issue中的解释也都很清晰 <a href="https://github.com/seajs/seajs/issues/547" target="_blank" rel="external">#547</a>其他的issue自己去找，都可以找得到的</p>
<a id="more"></a>
<h3 id="一：为什么使用require-js？"><a href="#一：为什么使用require-js？" class="headerlink" title="一：为什么使用require.js？"></a>一：为什么使用require.js？</h3><p>最早的时候，所有javascript代码都写在一个文件里，只要加载一个文件就够了，后来，代码越来越多，一个文件不够，必须分成多个文件，依次加载。<br><code>&lt;script src=&quot;1.js&quot;&gt;&lt;/script&gt;</code><br><code>&lt;script src=&quot;2.js&quot;&gt;&lt;/script&gt;</code><br><code>&lt;script src=&quot;3.js&quot;&gt;&lt;/script&gt;</code><br><code>&lt;script src=&quot;4.js&quot;&gt;&lt;/script&gt;</code><br><code>&lt;script src=&quot;5.js&quot;&gt;&lt;/script&gt;</code><br><code>&lt;script src=&quot;6.js&quot;&gt;&lt;/script&gt;</code><br>这段代码依次加载多个js文件。<br>这样的写法有很大缺点，首先，加载的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长；其次，由于js文件之间存在依赖关系，因此必须严格保证加载顺序。<br>require.js解决两大问题：<br>(1) 实现js文件的异步加载，避免网页失去响应。<br>(2) 管理模块之间的依赖性，便于代码的编写和维护。</p>
<h3 id="二：require-js加载？"><a href="#二：require-js加载？" class="headerlink" title="二：require.js加载？"></a>二：require.js加载？</h3><p>使用require.js的第一步，先去官网下载最新版本。<br>下载后，假定把它放在js子目录下，就可以加载了。<br><code>&lt;script src=&quot;js/require.js&quot;&gt;&lt;/script&gt;</code><br>加载这个文件，可能造成网页失去响应。解决办法有两个，一个是把脚本放在网页底部加载，另一个写成下面这样：<br><code>&lt;script src=&quot;js/require.js&quot; defer async=&quot;true&quot; &gt;&lt;/script&gt;</code><br>async属性表明这个文件需要异步加载，避免网页失去响应。但IE不支持这个属性，只支持defer，所以把defer也写上。<br>加载require.js以后，下一步就要加载我们自己的代码了。假定我们自己的代码文件是main.js,也放在js目录下面。那么，只需要写成下面这样就行了：<br><code>&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;</code><br>data-main属性的作用是，指定网页程序的主模块。就是js下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写为main。</p>
<h3 id="三、主模块写法："><a href="#三、主模块写法：" class="headerlink" title="三、主模块写法："></a>三、主模块写法：</h3><p>主模块依赖与其他的模块，这时就要使用AMD规范定义的require()函数。<br>//main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'moduleA'</span>,<span class="string">'moduleB'</span>,<span class="string">'moduleC'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">moduleA,moduleB,moduleC</span>)</span>&#123;</div><div class="line">    <span class="comment">//code</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>require()函数接收两个参数，第一个参数是一个数组，表示依赖的模块，第二个参数是一个回调函数，当前面指定的模块都加载成功后，他会被调用，<br>加载的模块会以参数的形式传入该函数，从而在回调中可以使用这些模块。<br>require()异步加载moduleA,moduleB,moduleC,浏览器不会失去响应，他指定的回调函数，只有当前面的模块都加载成功后，才会运行，解决了依赖性的问题。<br>假定主模块依赖jquery,underscore和backbone这三个模块，main.js就可以这样写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'jquery'</span>,<span class="string">'underscore'</span>,<span class="string">'backbone'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">$,_,Backbone</span>)</span>&#123;</div><div class="line">    <span class="comment">//code</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>require.js会先加载jquery,underscore和backbone,然后再运行回调函数，主模块的代码就写在回调函数中。</p>
<h3 id="四、模块的加载："><a href="#四、模块的加载：" class="headerlink" title="四、模块的加载："></a>四、模块的加载：</h3><p>默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。<br>使用require.config()方法，我们可以对模块的加载行为进行定义，require.config()就写在主模块（main.js）的头部，参数是一个对象，这个对象的paths属性指定各个模块的加载路径。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    <span class="attr">paths</span>:&#123;</div><div class="line">        <span class="string">"jQuery"</span>:jquery.min<span class="string">""</span>,</div><div class="line">        <span class="string">"underscore"</span>:<span class="string">"underscore.min"</span>,</div><div class="line">        <span class="string">"backbone"</span>:<span class="string">"backbone.min"</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面的代码给出了三个模块的文件名，路径默认与main.js在同一个目录，如果这些模块在其他目录，比如js/lib目录，则有两种写法，一种是逐一指定路径。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    <span class="attr">paths</span>:&#123;</div><div class="line">    <span class="string">"jquery"</span>:<span class="string">"lib/jquery.min"</span>,</div><div class="line">    <span class="string">"underscore"</span>: <span class="string">"lib/underscore.min"</span>,</div><div class="line">　　 <span class="string">"backbone"</span>: <span class="string">"lib/backbone.min"</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>另一种是直接改变基目录（baseUrl）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    <span class="attr">baseUrl</span>:<span class="string">"js/lib"</span>,</div><div class="line">    <span class="attr">paths</span>:&#123;</div><div class="line">        <span class="string">"jQuery"</span>:jquery.min<span class="string">""</span>,</div><div class="line">        <span class="string">"underscore"</span>:<span class="string">"underscore.min"</span>,</div><div class="line">        <span class="string">"backbone"</span>:<span class="string">"backbone.min"</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果某个模块在另一个主机上，也可以直接指定他的网址，<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    <span class="attr">paths</span>:&#123;</div><div class="line">        <span class="string">"jquery"</span>:<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min"</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="五、AMD模块写法："><a href="#五、AMD模块写法：" class="headerlink" title="五、AMD模块写法："></a>五、AMD模块写法：</h3><p>require.js加载的模块，采用AMD规范，具体来说，就是模块必须采用特定的define()函数来定义，如果一个模块不依赖其他模块，那么可以直接定义在define()函数中。<br>假定现在有一个main.js文件，它定义了一个math模块，<br>//math.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> add=<span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> x+y;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">add</span>:add</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>加载方法如下：<br>//main.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'math'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">math</span>)</span>&#123;</div><div class="line">    alert(math.add(<span class="number">1</span>,<span class="number">1</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">　define([<span class="string">'myLib'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">myLib</span>)</span>&#123;</div><div class="line">　　　　<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　myLib.doSomething();</div><div class="line">　　　　&#125;</div><div class="line">　　　　<span class="keyword">return</span> &#123;</div><div class="line">　　　　　　<span class="attr">foo</span> : foo</div><div class="line">　　　　&#125;;</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。</p>
<h3 id="六、加载非规范的模块"><a href="#六、加载非规范的模块" class="headerlink" title="六、加载非规范的模块"></a>六、加载非规范的模块</h3><p>举例来说，underscore和backbone这两个库，都没有采用AMD规范编写。如果要加载它们的话，必须先定义它们的特征。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">	<span class="attr">shim</span>:&#123;</div><div class="line">	    <span class="string">'underscore'</span>:&#123;</div><div class="line">	        <span class="attr">exports</span>:<span class="string">'_'</span></div><div class="line">	    &#125;,</div><div class="line">	    <span class="string">'backbone'</span>:&#123;</div><div class="line">	        <span class="attr">deps</span>:[<span class="string">'underscore'</span>,<span class="string">'jquery'</span>],</div><div class="line">	        <span class="attr">exports</span>:<span class="string">'Backbone'</span></div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>require.config()接受一个配置对象，这个对象除了有前面说的paths属性外，还有一个shim属性，专门来配置不兼容的模块，具体来说，每个模块要定义（1）exports值（输出的变量名），<br>表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。<br>比如，jquery可以这样定义：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">shim:&#123;</div><div class="line">    <span class="string">'jquery.scroll'</span>:&#123;</div><div class="line">        <span class="attr">deps</span>:[<span class="string">'jquery'</span>],</div><div class="line">        <span class="attr">exports</span>:<span class="string">'jQuery.fn.scroll'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/02/18/框架/angular/angular Directives/" class="prev">PREV</a><a href="/2017/01/18/工具类/在github pages利用hexo快速搭建静态个人主页以及更改域名/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://github.com/xuhongbo" target="_blank">xuhongbo-github</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>